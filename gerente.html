<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Panel del Gerente - Blue Elegance</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    :root {
      --primary: #1e40af;
      --primary-dark: #1e3a8a;
      --primary-light: #3b82f6;
      --accent: #06b6d4;
      --dark: #0f172a;
      --dark-light: #1e293b;
      --text: #f8fafc;
      --text-secondary: #cbd5e1;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --gold: #d4af37;
    }

    body {
      background: linear-gradient(135deg, var(--dark) 0%, #0a0f2b 50%, var(--dark) 100%);
      color: var(--text);
      line-height: 1.6;
      padding: 20px;
      min-height: 100vh;
      overflow-x: hidden;
    }

    .container {
      max-width: 1400px;
      margin: auto;
      background: rgba(15, 23, 42, 0.9);
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
      animation: slideUp 0.8s ease-out;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(30, 64, 175, 0.3);
    }

    @keyframes slideUp {
      from { transform: translateY(30px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 35px;
      padding: 25px;
      border-radius: 16px;
      background: linear-gradient(145deg, var(--dark-light), var(--dark));
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(30, 64, 175, 0.2);
    }

    header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: linear-gradient(90deg, var(--primary), var(--accent), var(--primary-light));
    }

    .logo-container {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .logo-img-container {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: linear-gradient(145deg, var(--dark-light), var(--dark));
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
      overflow: hidden;
      border: 3px solid var(--primary);
      position: relative;
    }

    .logo-img-container::after {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: linear-gradient(45deg, var(--primary), var(--accent), var(--primary-light));
      border-radius: 50%;
      z-index: -1;
      animation: rotate 3s linear infinite;
    }

    @keyframes rotate {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .logo-img-container img {
      max-width: 75%;
      max-height: 75%;
      object-fit: contain;
      border-radius: 50%;
    }

    .logo-text h1 {
      color: var(--text);
      font-size: 2.2rem;
      margin-bottom: 5px;
      font-weight: 700;
      background: linear-gradient(90deg, var(--primary-light), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .logo-text p {
      color: var(--text-secondary);
      font-size: 1.1rem;
      font-weight: 500;
      letter-spacing: 0.5px;
    }

    .header-controls {
      display: flex;
      gap: 12px;
    }

    h2 {
      color: var(--text);
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--primary);
      font-size: 1.8rem;
      display: flex;
      align-items: center;
      gap: 12px;
      position: relative;
    }

    h2::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 80px;
      height: 3px;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      border-radius: 3px;
    }

    /* Resumen general mejorado */
    .resumen-general {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 35px;
    }

    .resumen-item {
      background: linear-gradient(145deg, var(--dark-light), var(--dark));
      padding: 25px;
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      text-align: center;
      transition: all 0.4s ease;
      border-left: 4px solid var(--primary);
      position: relative;
      overflow: hidden;
    }

    .resumen-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(30, 64, 175, 0.1), rgba(6, 182, 212, 0.1));
      opacity: 0;
      transition: opacity 0.4s ease;
    }

    .resumen-item:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5);
    }

    .resumen-item:hover::before {
      opacity: 1;
    }

    .resumen-item .icono {
      font-size: 2.5rem;
      margin-bottom: 15px;
      color: var(--primary-light);
      transition: transform 0.3s ease;
    }

    .resumen-item:hover .icono {
      transform: scale(1.2);
      color: var(--accent);
    }

    .resumen-item .valor {
      font-size: 2.2rem;
      font-weight: bold;
      color: var(--text);
      margin-bottom: 8px;
      transition: color 0.3s ease;
    }

    .resumen-item:hover .valor {
      color: var(--accent);
    }

    .resumen-item .etiqueta {
      font-size: 1rem;
      color: var(--text-secondary);
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    /* NUEVOS ESTILOS PARA LAS MEJORAS */
    
    /* Indicador de eficiencia */
    .eficiencia-indicator {
      margin-top: 10px;
      padding: 8px;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 600;
      text-align: center;
      background: rgba(30, 64, 175, 0.2);
      border-left: 3px solid var(--primary);
    }
    
    .eficiencia-baja {
      background: rgba(239, 68, 68, 0.2);
      border-left-color: var(--danger);
      color: var(--danger);
    }
    
    .eficiencia-media {
      background: rgba(245, 158, 11, 0.2);
      border-left-color: var(--warning);
      color: var(--warning);
    }
    
    .eficiencia-alta {
      background: rgba(16, 185, 129, 0.2);
      border-left-color: var(--success);
      color: var(--success);
    }
    
    /* Secci√≥n de citas agregadas hoy */
    .citas-agregadas-hoy {
      background: linear-gradient(145deg, var(--dark-light), var(--dark));
      padding: 25px;
      border-radius: 16px;
      margin: 25px 0;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(30, 64, 175, 0.3);
      position: relative;
      overflow: hidden;
    }
    
    .citas-agregadas-hoy::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: linear-gradient(90deg, var(--primary), var(--accent), var(--primary-light));
    }
    
    .citas-agregadas-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .cita-agregada-item {
      background: rgba(30, 41, 59, 0.7);
      padding: 20px;
      border-radius: 12px;
      border-left: 4px solid var(--primary);
      transition: all 0.3s ease;
    }
    
    .cita-agregada-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
    }
    
    .cita-agregada-supervisora {
      font-weight: 600;
      color: var(--text);
      margin-bottom: 10px;
      font-size: 1.1rem;
    }
    
    .cita-agregada-cantidad {
      font-size: 1.8rem;
      font-weight: bold;
      color: var(--accent);
      margin-bottom: 8px;
    }
    
    .cita-agregada-eficiencia {
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    /* Panel del Gerente mejorado */
    .gerente-panel {
      background: linear-gradient(145deg, var(--dark-light), var(--dark));
      padding: 30px;
      border-radius: 16px;
      margin-top: 30px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(30, 64, 175, 0.2);
    }

    .gerente-panel::before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 200px;
      height: 200px;
      background: radial-gradient(circle, rgba(30, 64, 175, 0.1) 0%, rgba(30, 64, 175, 0) 70%);
      border-radius: 50%;
    }

    .gerente-panel h2 {
      color: var(--text);
      margin-bottom: 25px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .stats-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 35px;
    }

    .stat-card {
      flex: 1;
      min-width: 240px;
      background: linear-gradient(145deg, var(--dark-light), var(--dark));
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
      text-align: center;
      transition: all 0.4s ease;
      border-top: 4px solid var(--primary);
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      transform: scaleX(0);
      transform-origin: left;
      transition: transform 0.4s ease;
    }

    .stat-card:hover::before {
      transform: scaleX(1);
    }

    .stat-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 25px rgba(0, 0, 0, 0.5);
    }

    .stat-card.leader {
      background: linear-gradient(145deg, var(--primary-dark), var(--primary));
      color: var(--text);
      border-top: 4px solid var(--accent);
    }

    .stat-card h3 {
      font-size: 1.2rem;
      margin-bottom: 18px;
      color: inherit;
      font-weight: 600;
    }

    .stat-card .count {
      font-size: 2.5rem;
      font-weight: bold;
      margin-bottom: 12px;
      transition: transform 0.3s ease;
      color: var(--text);
    }

    .stat-card:hover .count {
      transform: scale(1.1);
      color: var(--accent);
    }

    .stat-card .supervisora {
      font-size: 0.95rem;
      opacity: 0.9;
      color: var(--text-secondary);
    }

    /* Estilo para mostrar el conteo por d√≠a */
    .conteo-dia {
      margin-top: 15px;
      padding: 12px;
      background: rgba(30, 41, 59, 0.7);
      border-radius: 8px;
      font-size: 0.9rem;
      border-left: 3px solid var(--primary);
    }

    .conteo-dia .titulo {
      font-weight: 600;
      color: var(--accent);
      margin-bottom: 5px;
    }

    .conteo-dia .valor-dia {
      font-size: 1.3rem;
      font-weight: bold;
      color: var(--text);
    }

    .supervisora-detalle {
      margin-top: 35px;
    }

    .supervisora-detalle h3 {
      margin-bottom: 20px;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 1.4rem;
    }

    .supervisora-citas {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }

    .cita-item {
      background: linear-gradient(145deg, var(--dark-light), var(--dark));
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 5px 12px rgba(0, 0, 0, 0.3);
      border-left: 4px solid var(--primary);
      font-size: 0.95rem;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .cita-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: linear-gradient(to bottom, var(--primary), var(--accent));
      transition: width 0.3s ease;
    }

    .cita-item:hover {
      transform: translateX(8px);
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.4);
    }

    .cita-item:hover::before {
      width: 6px;
    }

    .cita-item .cita-numero {
      font-weight: bold;
      color: var(--accent);
      font-size: 1.1rem;
    }

    .cita-item .cita-cliente {
      margin: 10px 0;
      font-weight: 500;
      color: var(--text);
    }

    .cita-item .cita-hora {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    /* Controles para el panel del gerente mejorados */
    .panel-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 30px;
      align-items: center;
      padding: 25px;
      background: rgba(30, 41, 59, 0.7);
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(5px);
      border: 1px solid rgba(30, 64, 175, 0.2);
    }

    .filtro-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: 18px;
      background: rgba(30, 41, 59, 0.8);
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
      min-width: 240px;
      border: 1px solid #334155;
      position: relative;
      overflow: hidden;
    }

    .filtro-group::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      transform: scaleX(0);
      transform-origin: left;
      transition: transform 0.3s ease;
    }

    .filtro-group:hover::before {
      transform: scaleX(1);
    }

    .filtro-group:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.4);
      background: rgba(30, 41, 59, 0.9);
    }

    .filtro-group label {
      margin: 0;
      font-size: 0.95rem;
      color: var(--text);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .filtro-group input, .filtro-group select {
      margin: 0;
      padding: 12px;
      border: 1px solid #475569;
      border-radius: 8px;
      background: var(--dark-light);
      color: var(--text);
      font-size: 0.95rem;
      transition: all 0.3s ease;
    }

    .filtro-group input:focus, .filtro-group select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.2);
      outline: none;
    }

    .btn-group {
      display: flex;
      gap: 15px;
      align-items: center;
      flex-wrap: wrap;
    }

    .btn-filtro {
      background: linear-gradient(145deg, var(--primary), var(--primary-dark));
      color: var(--text);
      border: none;
      padding: 14px 22px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 0.95rem;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 5px 12px rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: center;
      gap: 10px;
      position: relative;
      overflow: hidden;
    }

    .btn-filtro::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s ease;
    }

    .btn-filtro:hover::before {
      left: 100%;
    }

    .btn-filtro:hover {
      background: linear-gradient(145deg, var(--primary-light), var(--primary));
      transform: translateY(-3px);
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.4);
    }

    .btn-filtro:active {
      transform: translateY(0);
    }

    .btn-filtro i {
      font-size: 1.1rem;
    }

    .btn-limpiar {
      background: linear-gradient(145deg, var(--danger), #dc2626);
    }

    .btn-limpiar:hover {
      background: linear-gradient(145deg, #dc2626, #b91c1c);
    }

    .btn-exportar {
      background: linear-gradient(145deg, var(--success), #059669);
    }

    .btn-exportar:hover {
      background: linear-gradient(145deg, #059669, #047857);
    }

    .btn-volver {
      background: linear-gradient(145deg, #8b5cf6, #7c3aed);
    }

    .btn-volver:hover {
      background: linear-gradient(145deg, #7c3aed, #6d28d9);
    }

    .btn-citas-mes {
      background: linear-gradient(145deg, var(--gold), #b8941f);
    }

    .btn-citas-mes:hover {
      background: linear-gradient(145deg, #b8941f, var(--gold));
    }

    .sin-datos {
      text-align: center;
      padding: 50px;
      color: var(--text-secondary);
      font-style: italic;
      font-size: 1.2rem;
      background: rgba(30, 41, 59, 0.7);
      border-radius: 12px;
      box-shadow: 0 5px 12px rgba(0, 0, 0, 0.3);
    }

    .notificacion {
      position: fixed;
      top: 25px;
      right: 25px;
      background: linear-gradient(145deg, var(--success), #059669);
      color: var(--text);
      padding: 18px 25px;
      border-radius: 10px;
      z-index: 1000;
      box-shadow: 0 8px 20px rgba(0,0,0,0.4);
      animation: slideInRight 0.5s ease-out;
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 500;
      backdrop-filter: blur(5px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .notificacion.error {
      background: linear-gradient(145deg, var(--danger), #dc2626);
    }

    @keyframes slideInRight {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    .actualizando {
      display: inline-block;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Gr√°fico mejorado */
    .grafico-container {
      background: linear-gradient(145deg, var(--dark-light), var(--dark));
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
      margin-bottom: 30px;
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(30, 64, 175, 0.2);
    }

    .grafico-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: linear-gradient(90deg, var(--primary), var(--accent), var(--primary-light));
    }

    .barra {
      display: flex;
      align-items: center;
      margin-bottom: 18px;
      position: relative;
    }

    .barra-label {
      width: 160px;
      font-weight: 600;
      color: var(--text);
    }

    .barra-progreso {
      flex: 1;
      height: 28px;
      background: #334155;
      border-radius: 14px;
      overflow: hidden;
      position: relative;
      box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3);
    }

    .barra-relleno {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      border-radius: 14px;
      transition: width 1.2s ease;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding-right: 12px;
      color: var(--text);
      font-weight: 600;
      font-size: 0.85rem;
      position: relative;
      overflow: hidden;
    }

    .barra-relleno::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transform: translateX(-100%);
      animation: shine 2s infinite;
    }

    @keyframes shine {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    /* Estado de carga */
    .cargando {
      text-align: center;
      padding: 40px;
      color: var(--text-secondary);
    }

    .cargando i {
      font-size: 2rem;
      margin-bottom: 15px;
      animation: spin 1.5s linear infinite;
    }

    /* Estilos para la lista de supervisoras sin duplicados */
    .supervisoras-lista-unica {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 15px;
    }
    
    .supervisora-unica-item {
      background: rgba(30, 64, 175, 0.2);
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 0.9rem;
      color: var(--primary-light);
      border: 1px solid rgba(30, 64, 175, 0.5);
    }

    /* Estilos para el modal de citas del mes */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.8);
      animation: fadeIn 0.3s;
      overflow-y: auto;
    }

    .modal-contenido {
      background: linear-gradient(145deg, var(--dark-light), var(--dark));
      margin: 2% auto;
      padding: 30px;
      border-radius: 16px;
      width: 95%;
      max-width: 1400px;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
      animation: slideDown 0.3s;
      border: 1px solid rgba(30, 64, 175, 0.3);
      position: relative;
      overflow: hidden;
    }

    .modal-contenido::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--gold), #f4d03f, var(--gold));
    }

    @keyframes slideDown {
      from { transform: translateY(-50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(212, 175, 55, 0.3);
    }

    .modal-header h3 {
      color: var(--gold);
      font-size: 1.8rem;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .cerrar-modal {
      color: var(--gold);
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .cerrar-modal:hover {
      color: #f4d03f;
      transform: rotate(90deg);
    }

    /* Pesta√±as para las citas del mes */
    .pestanas-mes {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 25px;
      padding: 15px;
      background: rgba(30, 41, 59, 0.7);
      border-radius: 12px;
      border: 1px solid rgba(212, 175, 55, 0.2);
    }

    .pestana-dia {
      background: linear-gradient(145deg, var(--dark-light), var(--dark));
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      border: 1px solid rgba(212, 175, 55, 0.3);
      color: var(--text);
      position: relative;
      overflow: hidden;
    }

    .pestana-dia::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background: linear-gradient(90deg, var(--gold), #f4d03f);
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }

    .pestana-dia.activa {
      background: linear-gradient(145deg, rgba(212, 175, 55, 0.2), rgba(244, 208, 63, 0.1));
      border-color: var(--gold);
      color: var(--gold);
    }

    .pestana-dia.activa::before {
      transform: scaleX(1);
    }

    .pestana-dia:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(212, 175, 55, 0.3);
    }

    .contenido-pestana {
      display: none;
    }

    .contenido-pestana.activa {
      display: block;
    }

    .resumen-citas-mes {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .resumen-mes-item {
      background: linear-gradient(145deg, var(--dark-light), var(--dark));
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
      text-align: center;
      border-left: 4px solid var(--gold);
    }

    .resumen-mes-item .titulo {
      font-size: 1.1rem;
      color: var(--text-secondary);
      margin-bottom: 10px;
    }

    .resumen-mes-item .valor {
      font-size: 2.2rem;
      font-weight: bold;
      color: var(--gold);
      margin-bottom: 8px;
    }

    .resumen-mes-item .detalle {
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    /* Responsive */
    @media (max-width: 1200px) {
      .container {
        max-width: 95%;
        padding: 25px;
      }
      
      .resumen-general {
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      }
    }

    @media (max-width: 992px) {
      .container {
        padding: 20px;
      }
      
      header {
        flex-direction: column;
        gap: 25px;
        text-align: center;
      }
      
      .logo-text h1 {
        font-size: 2.2rem;
      }
      
      .header-controls {
        justify-content: center;
        flex-wrap: wrap;
        width: 100%;
      }
      
      .stats-container {
        flex-direction: column;
      }
      
      .supervisora-citas {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      }
      
      .panel-controls {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .filtro-group {
        min-width: 100%;
      }
      
      .btn-group {
        width: 100%;
        justify-content: center;
      }
    }

    @media (max-width: 768px) {
      body {
        padding: 15px;
      }
      
      .container {
        padding: 15px;
        border-radius: 15px;
      }
      
      header {
        padding: 20px;
      }
      
      .logo-container {
        flex-direction: column;
        gap: 15px;
      }
      
      .logo-text h1 {
        font-size: 2rem;
      }
      
      .logo-text p {
        font-size: 1.1rem;
      }
      
      .resumen-general {
        grid-template-columns: 1fr;
        gap: 20px;
      }
      
      .gerente-panel {
        padding: 20px;
      }
      
      .supervisora-citas {
        grid-template-columns: 1fr;
      }
      
      .panel-controls {
        padding: 20px;
      }
      
      h2 {
        font-size: 1.7rem;
      }
      
      .notificacion {
        top: 15px;
        right: 15px;
        left: 15px;
        text-align: center;
        justify-content: center;
      }
      
      .pestanas-mes {
        flex-direction: column;
      }
      
      .pestana-dia {
        text-align: center;
      }
    }

    @media (max-width: 576px) {
      body {
        padding: 10px;
      }
      
      .container {
        padding: 15px;
      }
      
      .logo-img-container {
        width: 80px;
        height: 80px;
      }
      
      .logo-text h1 {
        font-size: 1.8rem;
      }
      
      .resumen-item {
        padding: 20px;
      }
      
      .resumen-item .valor {
        font-size: 2.2rem;
      }
    }
  </style>
</head>
<body>
  <!-- Modal para citas del mes -->
  <div id="modalCitasMes" class="modal">
    <div class="modal-contenido">
      <div class="modal-header">
        <h3><i class="fas fa-calendar-alt"></i> CITAS DEL MES</h3>
        <span class="cerrar-modal">&times;</span>
      </div>
      <div id="contenidoCitasMes">
        <!-- El contenido se cargar√° din√°micamente -->
      </div>
    </div>
  </div>

  <div class="container">
    <header>
      <div class="logo-container">
        <div class="logo-img-container">
          <img src="Imagenes/logo.png" alt="Logo Blue Elegance">
        </div>
        <div class="logo-text">
          <h1>BLUE ELEGANCE</h1>
          <p>PANEL DE CONTROL - GERENTE</p>
        </div>
      </div>
      <div class="header-controls">
        <button class="btn-filtro" id="actualizarBtn">
          <i class="fas fa-sync-alt"></i> ACTUALIZAR
        </button>
        <button class="btn-filtro btn-citas-mes" id="btnCitasMes">
          <i class="fas fa-calendar-alt"></i> VER CITAS DEL MES
        </button>
        <button class="btn-filtro btn-exportar" id="exportarEstadisticas">
          <i class="fas fa-file-excel"></i> EXPORTAR ESTAD√çSTICAS
        </button>
        <button class="btn-filtro btn-volver" onclick="window.location.href='index.html'">
          <i class="fas fa-arrow-left"></i> VOLVER AL SISTEMA
        </button>
      </div>
    </header>

    <!-- Resumen General -->
    <section class="resumen-general" id="resumenGeneral">
      <div class="cargando">
        <i class="fas fa-spinner"></i>
        <p>CARGANDO DATOS...</p>
      </div>
    </section>

    <!-- NUEVA SECCI√ìN: Citas Agregadas Hoy -->
    <section class="citas-agregadas-hoy" id="citasAgregadasHoy">
      <h2><i class="fas fa-calendar-plus"></i> CITAS AGREGADAS HOY</h2>
      <div class="citas-agregadas-grid" id="citasAgregadasGrid">
        <div class="cargando">
          <i class="fas fa-spinner"></i>
          <p>CARGANDO CITAS DE HOY...</p>
        </div>
      </div>
    </section>

    <!-- Gr√°fico de distribuci√≥n -->
    <div class="grafico-container">
      <h2><i class="fas fa-chart-bar"></i> DISTRIBUCI√ìN DE CITAS POR SUPERVISORA</h2>
      <div id="graficoBarras">
        <div class="cargando">
          <i class="fas fa-spinner"></i>
          <p>CARGANDO GR√ÅFICO...</p>
        </div>
      </div>
    </div>

    <!-- Panel del Gerente -->
    <section class="gerente-panel">
      <h2><i class="fas fa-chart-line"></i> ESTAD√çSTICAS POR SUPERVISORA</h2>
      
      <!-- Controles para el panel del gerente -->
      <div class="panel-controls">
        <div class="filtro-group">
          <label for="filtroFecha"><i class="fas fa-calendar-alt"></i> FILTRAR POR FECHA:</label>
          <input type="date" id="filtroFecha">
        </div>
        
        <div class="filtro-group">
          <label for="filtroSupervisora"><i class="fas fa-user-tie"></i> FILTRAR POR SUPERVISORA:</label>
          <select id="filtroSupervisora">
            <option value="">CARGANDO SUPERVISORAS...</option>
          </select>
        </div>
        
        <div class="btn-group">
          <button type="button" id="aplicarFiltro" class="btn-filtro">
            <i class="fas fa-filter"></i> APLICAR FILTROS
          </button>
          <button type="button" id="limpiarFiltro" class="btn-filtro btn-limpiar">
            <i class="fas fa-broom"></i> LIMPIAR
          </button>
        </div>
      </div>
      
      <div class="stats-container" id="statsContainer">
        <div class="cargando">
          <i class="fas fa-spinner"></i>
          <p>CARGANDO ESTAD√çSTICAS...</p>
        </div>
      </div>
      
      <div class="supervisora-detalle" id="supervisoraDetalle">
        <div class="cargando">
          <i class="fas fa-spinner"></i>
          <p>CARGANDO DETALLES DE CITAS...</p>
        </div>
      </div>
    </section>
  </div>

  <!-- Librer√≠as necesarias -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <!-- ExcelJS para estilos en Excel -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.4.0/exceljs.min.js"></script>
  <!-- FileSaver para guardar archivos -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

  <script>
    // Configuraci√≥n de Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyASUJrQNMW80DDMV8gFzjTYPUd8x3B5YDk",
      authDomain: "invitacionpremanfiesto.firebaseapp.com",
      databaseURL: "https://invitacionpremanfiesto-default-rtdb.firebaseio.com",
      projectId: "invitacionpremanfiesto",
      storageBucket: "invitacionpremanfiesto.firebasestorage.app",
      messagingSenderId: "362764197269",
      appId: "1:362764197269:web:058b028dcc53d299df6a9c",
      measurementId: "G-JYTW87S1MP"
    };

    // Inicializar Firebase
    firebase.initializeApp(firebaseConfig);

    // Variables globales
    let listaSupervisoras = [];
    let registrosPremanifiesto = [];

    document.addEventListener("DOMContentLoaded", function () {
      // --- FUNCIONES PRINCIPALES ---

      // FUNCI√ìN MEJORADA: Convertir datos de Firebase a array
      function convertirDatosFirebase(snapshotData) {
        console.log("üìä DATOS RECIBIDOS DE FIREBASE:", snapshotData);
        
        if (!snapshotData) {
          console.log("‚ùå NO HAY DATOS EN FIREBASE");
          return [];
        }
        
        if (Array.isArray(snapshotData)) {
          console.log("‚úÖ LOS DATOS YA SON UN ARRAY");
          return snapshotData.filter(item => item !== null && item !== undefined);
        }
        
        if (typeof snapshotData === 'object') {
          console.log("üîÑ CONVIRTIENDO OBJETO A ARRAY...");
          const arrayResultado = Object.values(snapshotData).filter(item => item !== null && item !== undefined);
          console.log("‚úÖ CONVERSI√ìN EXITOSA:", arrayResultado.length, "REGISTROS");
          return arrayResultado;
        }
        
        console.log("‚ùå FORMATO DE DATOS NO RECONOCIDO");
        return [];
      }

      // FUNCI√ìN MEJORADA: Configurar Firebase
      function configurarFirebase() {
        const database = firebase.database();
        const registrosRef = database.ref('registrosPremanifiesto');
        
        console.log("üîÑ CONECTANDO A FIREBASE DESDE EL PANEL DEL GERENTE...");
        
        // Escuchar cambios en tiempo real desde Firebase
        registrosRef.on('value', (snapshot) => {
          const data = snapshot.val();
          console.log("üìä DATOS CRUDOS DE FIREBASE:", data);
          
          if (!data) {
            console.log("‚ùå NO HAY DATOS EN FIREBASE");
            registrosPremanifiesto = [];
            mostrarNotificacion("NO HAY DATOS EN LA BASE DE DATOS", 'error');
            return;
          }
          
          registrosPremanifiesto = convertirDatosFirebase(data);
          
          console.log("‚úÖ DATOS PROCESADOS:", registrosPremanifiesto.length, "REGISTROS");
          
          if (registrosPremanifiesto.length > 0) {
            console.log("üìù PRIMER REGISTRO:", registrosPremanifiesto[0]);
          }
          
          // Actualizar TODAS las secciones del panel
          actualizarTodoElPanel();
          mostrarNotificacion("DATOS ACTUALIZADOS CORRECTAMENTE DESDE FIREBASE");
          
        }, (error) => {
          console.error("üî• ERROR DE FIREBASE:", error);
          mostrarNotificacion("ERROR AL CONECTAR CON FIREBASE: " + error.message, 'error');
        });
        
        // Configurar listener para supervisoras
        configurarListenerSupervisoras();
      }

      function configurarListenerSupervisoras() {
        const database = firebase.database();
        
        database.ref('supervisoras').on('value', (snapshot) => {
          const data = snapshot.val();
          console.log("üë• DATOS DE SUPERVISORAS:", data);
          
          if (data) {
            // Manejar diferentes formatos de datos
            if (Array.isArray(data)) {
              listaSupervisoras = [...new Set(data.filter(s => s && s.trim() !== ''))];
            } else if (typeof data === 'object') {
              listaSupervisoras = [...new Set(Object.values(data).filter(s => s && s.trim() !== ''))];
            } else {
              listaSupervisoras = [];
            }
            
            cargarListaSupervisoras();
            console.log("‚úÖ SUPERVISORAS ACTUALIZADAS:", listaSupervisoras);
            
            if (registrosPremanifiesto.length > 0) {
              actualizarTodoElPanel();
            }
          } else {
            console.log("‚ùå NO HAY DATOS DE SUPERVISORAS");
            listaSupervisoras = [];
            cargarListaSupervisoras();
          }
        }, (error) => {
          console.error("üî• ERROR AL CARGAR SUPERVISORAS:", error);
          mostrarNotificacion("ERROR AL CARGAR LISTA DE SUPERVISORAS", 'error');
        });
      }

      // NUEVA FUNCI√ìN: Actualizar todo el panel de una vez
      function actualizarTodoElPanel() {
        console.log("üîÑ ACTUALIZANDO TODO EL PANEL...");
        
        try {
          actualizarResumenGeneral();
          actualizarCitasAgregadasHoy();
          actualizarEstadisticasSupervisoras();
          actualizarGraficoBarras();
          actualizarDetallesCitas();
        } catch (error) {
          console.error("‚ùå ERROR AL ACTUALIZAR EL PANEL:", error);
          mostrarNotificacion("ERROR AL ACTUALIZAR LA INFORMACI√ìN", 'error');
        }
      }

      // --- FUNCIONES DE C√ÅLCULO DE EFICIENCIA ---
      
      function calcularEficienciaSupervisora(citasHoy) {
        // REGLA DE TRES MEJORADA: 8 citas = 100% de eficiencia
        if (citasHoy === 0) return 0;
        const eficiencia = Math.min(100, Math.round((citasHoy / 8) * 100));
        return eficiencia;
      }
      
      function obtenerClaseEficiencia(eficiencia) {
        if (eficiencia < 50) return 'eficiencia-baja';
        if (eficiencia < 80) return 'eficiencia-media';
        return 'eficiencia-alta';
      }
      
      function obtenerTextoEficiencia(citasHoy, eficiencia) {
        if (eficiencia === 0) {
          return `META: 8 CITAS/D√çA (${8} FALTANTES)`;
        }
        return `EFICIENCIA: ${eficiencia}% (${citasHoy}/8 CITAS)`;
      }
      
      function calcularEficienciaGeneral(citasHoyTotal) {
        // EFICIENCIA GENERAL DEL EQUIPO: total de citas hoy vs meta total
        const metaTotal = listaSupervisoras.length * 8;
        const eficienciaGeneral = Math.min(100, Math.round((citasHoyTotal / metaTotal) * 100));
        return eficienciaGeneral;
      }

      // --- FUNCIONES DE ACTUALIZACI√ìN DE UI ---

      function actualizarResumenGeneral() {
        const resumenContainer = document.getElementById('resumenGeneral');
        
        const totalCitas = registrosPremanifiesto.length;
        const hoy = new Date().toISOString().split('T')[0];
        const citasHoy = registrosPremanifiesto.filter(reg => 
          reg.fechaRegistro && reg.fechaRegistro.includes(hoy)
        ).length;
        
        const supervisorasActivas = listaSupervisoras.length;
        const eficienciaGeneral = calcularEficienciaGeneral(citasHoy);
        
        resumenContainer.innerHTML = `
          <div class="resumen-item">
            <div class="icono"><i class="fas fa-calendar-check"></i></div>
            <div class="valor">${totalCitas}</div>
            <div class="etiqueta">TOTAL DE CITAS</div>
          </div>
          <div class="resumen-item">
            <div class="icono"><i class="fas fa-calendar-day"></i></div>
            <div class="valor">${citasHoy}</div>
            <div class="etiqueta">CITAS HOY</div>
          </div>
          <div class="resumen-item">
            <div class="icono"><i class="fas fa-users"></i></div>
            <div class="valor">${supervisorasActivas}</div>
            <div class="etiqueta">SUPERVISORAS ACTIVAS</div>
          </div>
          <div class="resumen-item">
            <div class="icono"><i class="fas fa-chart-line"></i></div>
            <div class="valor">${eficienciaGeneral}%</div>
            <div class="etiqueta">EFICIENCIA DEL EQUIPO</div>
          </div>
        `;
      }

      function actualizarCitasAgregadasHoy() {
        const citasAgregadasGrid = document.getElementById('citasAgregadasGrid');
        const hoy = new Date().toISOString().split('T')[0];
        
        const citasHoyPorSupervisora = {};
        let totalCitasHoy = 0;
        
        listaSupervisoras.forEach(supervisora => {
          const citasHoy = registrosPremanifiesto.filter(reg => 
            reg.supervisora === supervisora && 
            reg.fechaRegistro && 
            reg.fechaRegistro.includes(hoy)
          ).length;
          
          citasHoyPorSupervisora[supervisora] = citasHoy;
          totalCitasHoy += citasHoy;
        });
        
        const supervisorasOrdenadas = Object.keys(citasHoyPorSupervisora).sort((a, b) => 
          citasHoyPorSupervisora[b] - citasHoyPorSupervisora[a]
        );
        
        let html = '';
        
        supervisorasOrdenadas.forEach(supervisora => {
          const citasHoy = citasHoyPorSupervisora[supervisora];
          const eficiencia = calcularEficienciaSupervisora(citasHoy);
          const claseEficiencia = obtenerClaseEficiencia(eficiencia);
          const textoEficiencia = obtenerTextoEficiencia(citasHoy, eficiencia);
          
          html += `
            <div class="cita-agregada-item">
              <div class="cita-agregada-supervisora">${supervisora}</div>
              <div class="cita-agregada-cantidad">${citasHoy} CITAS</div>
              <div class="cita-agregada-eficiencia ${claseEficiencia}">${textoEficiencia}</div>
            </div>
          `;
        });
        
        if (html === '') {
          html = '<div class="sin-datos">NO SE HAN AGREGADO CITAS HOY</div>';
        }
        
        citasAgregadasGrid.innerHTML = html;
      }

      function cargarListaSupervisoras() {
        const selectFiltro = document.getElementById('filtroSupervisora');
        
        selectFiltro.innerHTML = '<option value="">TODAS LAS SUPERVISORAS</option>';
        
        listaSupervisoras.forEach(supervisora => {
          const optionFiltro = document.createElement('option');
          optionFiltro.value = supervisora;
          optionFiltro.textContent = supervisora;
          selectFiltro.appendChild(optionFiltro);
        });
      }

      function actualizarEstadisticasSupervisoras() {
        const statsContainer = document.getElementById('statsContainer');
        const filtroFecha = document.getElementById('filtroFecha').value;
        const filtroSupervisora = document.getElementById('filtroSupervisora').value;
        
        let registrosFiltrados = [...registrosPremanifiesto];
        
        if (filtroFecha) {
          registrosFiltrados = registrosFiltrados.filter(reg => 
            reg.fechaRegistro && reg.fechaRegistro.includes(filtroFecha)
          );
        }
        
        if (filtroSupervisora) {
          registrosFiltrados = registrosFiltrados.filter(reg => 
            reg.supervisora === filtroSupervisora
          );
        }
        
        const statsPorSupervisora = {};
        const hoy = new Date().toISOString().split('T')[0];
        
        listaSupervisoras.forEach(supervisora => {
          const citasSupervisora = registrosFiltrados.filter(reg => reg.supervisora === supervisora);
          const citasHoy = citasSupervisora.filter(reg => 
            reg.fechaRegistro && reg.fechaRegistro.includes(hoy)
          ).length;
          
          const eficiencia = calcularEficienciaSupervisora(citasHoy);
          const claseEficiencia = obtenerClaseEficiencia(eficiencia);
          const textoEficiencia = obtenerTextoEficiencia(citasHoy, eficiencia);
          
          statsPorSupervisora[supervisora] = {
            total: citasSupervisora.length,
            hoy: citasHoy,
            eficiencia: eficiencia,
            claseEficiencia: claseEficiencia,
            textoEficiencia: textoEficiencia
          };
        });
        
        const supervisorasOrdenadas = Object.keys(statsPorSupervisora).sort((a, b) => 
          statsPorSupervisora[b].total - statsPorSupervisora[a].total
        );
        
        let html = '';
        
        supervisorasOrdenadas.forEach((supervisora, index) => {
          const stats = statsPorSupervisora[supervisora];
          const esLider = index === 0 && stats.total > 0;
          
          html += `
            <div class="stat-card ${esLider ? 'leader' : ''}">
              <h3>${supervisora}</h3>
              <div class="count">${stats.total}</div>
              <div class="supervisora">TOTAL DE CITAS</div>
              <div class="conteo-dia">
                <div class="titulo">CITAS HOY</div>
                <div class="valor-dia">${stats.hoy}</div>
              </div>
              <div class="eficiencia-indicator ${stats.claseEficiencia}">
                ${stats.textoEficiencia}
              </div>
              ${esLider ? '<div class="supervisora">üèÜ L√çDER DEL D√çA</div>' : ''}
            </div>
          `;
        });
        
        statsContainer.innerHTML = html || '<div class="sin-datos">NO HAY DATOS DISPONIBLES</div>';
      }

      function actualizarGraficoBarras() {
        const graficoContainer = document.getElementById('graficoBarras');
        const filtroFecha = document.getElementById('filtroFecha').value;
        const filtroSupervisora = document.getElementById('filtroSupervisora').value;
        
        let registrosFiltrados = [...registrosPremanifiesto];
        
        if (filtroFecha) {
          registrosFiltrados = registrosFiltrados.filter(reg => 
            reg.fechaRegistro && reg.fechaRegistro.includes(filtroFecha)
          );
        }
        
        if (filtroSupervisora) {
          registrosFiltrados = registrosFiltrados.filter(reg => 
            reg.supervisora === filtroSupervisora
          );
        }
        
        const statsPorSupervisora = {};
        const totalCitas = registrosFiltrados.length;
        
        listaSupervisoras.forEach(supervisora => {
          const citasSupervisora = registrosFiltrados.filter(reg => reg.supervisora === supervisora);
          statsPorSupervisora[supervisora] = citasSupervisora.length;
        });
        
        const supervisorasOrdenadas = Object.keys(statsPorSupervisora).sort((a, b) => 
          statsPorSupervisora[b] - statsPorSupervisora[a]
        );
        
        let html = '';
        
        supervisorasOrdenadas.forEach(supervisora => {
          const count = statsPorSupervisora[supervisora];
          const porcentaje = totalCitas > 0 ? Math.round((count / totalCitas) * 100) : 0;
          
          html += `
            <div class="barra">
              <div class="barra-label">${supervisora}</div>
              <div class="barra-progreso">
                <div class="barra-relleno" style="width: ${porcentaje}%">
                  ${count} (${porcentaje}%)
                </div>
              </div>
            </div>
          `;
        });
        
        graficoContainer.innerHTML = html || '<div class="sin-datos">NO HAY DATOS PARA MOSTRAR</div>';
      }

      function actualizarDetallesCitas() {
        const detalleContainer = document.getElementById('supervisoraDetalle');
        const filtroFecha = document.getElementById('filtroFecha').value;
        const filtroSupervisora = document.getElementById('filtroSupervisora').value;
        
        let registrosFiltrados = [...registrosPremanifiesto];
        
        if (filtroFecha) {
          registrosFiltrados = registrosFiltrados.filter(reg => 
            reg.fechaRegistro && reg.fechaRegistro.includes(filtroFecha)
          );
        }
        
        if (filtroSupervisora) {
          registrosFiltrados = registrosFiltrados.filter(reg => 
            reg.supervisora === filtroSupervisora
          );
        }
        
        const citasPorSupervisora = {};
        
        listaSupervisoras.forEach(supervisora => {
          citasPorSupervisora[supervisora] = registrosFiltrados.filter(reg => reg.supervisora === supervisora);
        });
        
        let html = '';
        
        Object.keys(citasPorSupervisora).forEach(supervisora => {
          const citas = citasPorSupervisora[supervisora];
          
          if (citas.length > 0) {
            html += `
              <div class="supervisora-detalle">
                <h3><i class="fas fa-user-tie"></i> ${supervisora} - ${citas.length} CITAS</h3>
                <div class="supervisora-citas">
            `;
            
            citas.forEach((cita, index) => {
              html += `
                <div class="cita-item">
                  <div class="cita-numero">CITA #${index + 1}</div>
                  <div class="cita-cliente">${cita.nombre || 'CLIENTE NO ESPECIFICADO'}</div>
                  <div class="cita-hora">${cita.hora || 'HORA NO ESPECIFICADA'} - ${cita.fechaRegistro || 'FECHA NO ESPECIFICADA'}</div>
                  <div class="cita-detalles">
                    <small>PERSONAS: ${cita.numPersonas || 'N/A'} | EDAD: ${cita.edad || 'N/A'} | HOTEL: ${cita.hotel || 'N/A'}</small>
                  </div>
                </div>
              `;
            });
            
            html += `
                </div>
              </div>
            `;
          }
        });
        
        detalleContainer.innerHTML = html || '<div class="sin-datos">NO HAY CITAS PARA MOSTRAR CON LOS FILTROS ACTUALES</div>';
      }

      // --- NUEVAS FUNCIONALIDADES SOLICITADAS ---

      // FUNCI√ìN PARA OBTENER CITAS POR D√çA (CORREGIDA)
      function obtenerCitasPorDia(fechaEspecifica = null) {
        const fecha = fechaEspecifica ? new Date(fechaEspecifica) : new Date();
        const fechaFormateada = fecha.toISOString().split('T')[0];
        
        // Obtener citas del d√≠a espec√≠fico
        const citasDelDia = registrosPremanifiesto.filter(registro => 
          registro.diaEvento === fechaFormateada
        );
        
        return citasDelDia;
      }

      // FUNCI√ìN PARA MOSTRAR CITAS DEL MES
      function mostrarCitasDelMes() {
        const modal = document.getElementById('modalCitasMes');
        const contenido = document.getElementById('contenidoCitasMes');
        
        // Obtener el mes actual
        const hoy = new Date();
        const a√±o = hoy.getFullYear();
        const mes = hoy.getMonth();
        
        // Obtener todos los d√≠as del mes
        const diasDelMes = new Date(a√±o, mes + 1, 0).getDate();
        
        // Agrupar citas por d√≠a
        const citasPorDia = {};
        let totalCitasMes = 0;
        let mejorBase = '';
        let maxCitas = 0;
        
        for (let dia = 1; dia <= diasDelMes; dia++) {
          const fecha = `${a√±o}-${String(mes + 1).padStart(2, '0')}-${String(dia).padStart(2, '0')}`;
          const citasDia = registrosPremanifiesto.filter(registro => 
            registro.diaEvento === fecha
          );
          
          citasPorDia[fecha] = citasDia;
          totalCitasMes += citasDia.length;
          
          // Encontrar la mejor base
          citasDia.forEach(cita => {
            const base = cita.baseDatos || 'Sin Base';
            if (!citasPorDia[base]) citasPorDia[base] = 0;
            citasPorDia[base]++;
            
            if (citasPorDia[base] > maxCitas) {
              maxCitas = citasPorDia[base];
              mejorBase = base;
            }
          });
        }
        
        // Calcular porcentaje de la mejor base
        const porcentajeMejorBase = totalCitasMes > 0 ? 
          Math.round((maxCitas / totalCitasMes) * 100) : 0;
        
        // Generar HTML para el modal
        let html = `
          <div class="resumen-citas-mes">
            <div class="resumen-mes-item">
              <div class="titulo">TOTAL DE CITAS DEL MES</div>
              <div class="valor">${totalCitasMes}</div>
              <div class="detalle">Todas las citas programadas</div>
            </div>
            <div class="resumen-mes-item">
              <div class="titulo">MEJOR BASE</div>
              <div class="valor">${mejorBase || 'N/A'}</div>
              <div class="detalle">${maxCitas} citas (${porcentajeMejorBase}%)</div>
            </div>
          </div>
          
          <div class="pestanas-mes" id="pestanasMes">
        `;
        
        // Crear pesta√±as para cada d√≠a con citas
        Object.keys(citasPorDia).sort().forEach((fecha, index) => {
          if (fecha.includes('-') && citasPorDia[fecha].length > 0) {
            const fechaObj = new Date(fecha);
            const nombreDia = fechaObj.toLocaleDateString('es-MX', { 
              weekday: 'short', 
              day: '2-digit', 
              month: 'short' 
            }).toUpperCase();
            
            html += `
              <div class="pestana-dia ${index === 0 ? 'activa' : ''}" data-fecha="${fecha}">
                ${nombreDia.replace('.', '')} (${citasPorDia[fecha].length})
              </div>
            `;
          }
        });
        
        html += `</div>`;
        
        // Crear contenido para cada pesta√±a
        Object.keys(citasPorDia).sort().forEach((fecha, index) => {
          if (fecha.includes('-') && citasPorDia[fecha].length > 0) {
            html += `
              <div class="contenido-pestana ${index === 0 ? 'activa' : ''}" id="contenido-${fecha}">
                <h4>CITAS DEL ${new Date(fecha).toLocaleDateString('es-MX', { 
                  weekday: 'long', 
                  year: 'numeric', 
                  month: 'long', 
                  day: 'numeric' 
                }).toUpperCase()}</h4>
                <div class="supervisora-citas">
            `;
            
            citasPorDia[fecha].forEach((cita, citaIndex) => {
              html += `
                <div class="cita-item">
                  <div class="cita-numero">CITA #${citaIndex + 1}</div>
                  <div class="cita-cliente">${cita.nombre || 'CLIENTE NO ESPECIFICADO'}</div>
                  <div class="cita-hora">${cita.hora || 'HORA NO ESPECIFICADA'}</div>
                  <div class="cita-detalles">
                    <small>SUPERVISORA: ${cita.supervisora || 'N/A'} | HOTEL: ${cita.hotel || 'N/A'} | CALIFICACI√ìN: ${cita.calificacionOrigen || 'N/A'}</small>
                  </div>
                </div>
              `;
            });
            
            html += `
                </div>
              </div>
            `;
          }
        });
        
        contenido.innerHTML = html;
        modal.style.display = 'block';
        
        // Configurar eventos para las pesta√±as
        const pestanas = document.querySelectorAll('.pestana-dia');
        pestanas.forEach(pestana => {
          pestana.addEventListener('click', function() {
            const fecha = this.getAttribute('data-fecha');
            
            // Remover clase activa de todas las pesta√±as
            pestanas.forEach(p => p.classList.remove('activa'));
            // Agregar clase activa a la pesta√±a clickeada
            this.classList.add('activa');
            
            // Ocultar todos los contenidos
            document.querySelectorAll('.contenido-pestana').forEach(contenido => {
              contenido.classList.remove('activa');
            });
            
            // Mostrar el contenido correspondiente
            document.getElementById(`contenido-${fecha}`).classList.add('activa');
          });
        });
      }

      // FUNCI√ìN PARA OBTENER CITAS POR SUPERVISOR (CORREGIDA)
      function obtenerCitasPorSupervisora(supervisora) {
        return registrosPremanifiesto.filter(registro => 
          registro.supervisora === supervisora
        );
      }

      function mostrarNotificacion(mensaje, tipo = 'success') {
        const notificacion = document.createElement('div');
        notificacion.innerHTML = `<i class="fas fa-${tipo === 'error' ? 'exclamation-triangle' : 'info-circle'}"></i> ${mensaje}`;
        notificacion.className = `notificacion ${tipo === 'error' ? 'error' : ''}`;
        
        document.body.appendChild(notificacion);
        
        setTimeout(() => {
          if (notificacion.parentNode) {
            document.body.removeChild(notificacion);
          }
        }, 4000);
      }

      // --- INICIALIZACI√ìN ---

      function inicializarSistema() {
        console.log("üöÄ INICIALIZANDO SISTEMA...");
        
        configurarFirebase();
        
        const hoy = new Date().toISOString().split('T')[0];
        document.getElementById('filtroFecha').value = hoy;
        
        configurarEventListeners();
        
        console.log("‚úÖ SISTEMA INICIALIZADO CORRECTAMENTE");
      }

      function configurarEventListeners() {
        const actualizarBtn = document.getElementById('actualizarBtn');
        const exportarBtn = document.getElementById('exportarEstadisticas');
        const aplicarFiltroBtn = document.getElementById('aplicarFiltro');
        const limpiarFiltroBtn = document.getElementById('limpiarFiltro');
        const btnCitasMes = document.getElementById('btnCitasMes');
        const modal = document.getElementById('modalCitasMes');
        const cerrarModal = document.querySelector('.cerrar-modal');
        
        if (!actualizarBtn || !exportarBtn || !aplicarFiltroBtn || !limpiarFiltroBtn) {
          console.error("‚ùå NO SE ENCONTRARON TODOS LOS ELEMENTOS DEL DOM");
          setTimeout(configurarEventListeners, 1000);
          return;
        }
        
        actualizarBtn.addEventListener('click', function() {
          const btn = this;
          const icono = btn.querySelector('i');
          
          icono.classList.add('actualizando');
          btn.disabled = true;
          
          setTimeout(() => {
            actualizarTodoElPanel();
            icono.classList.remove('actualizando');
            btn.disabled = false;
            mostrarNotificacion('DATOS ACTUALIZADOS MANUALMENTE');
          }, 1000);
        });
        
        aplicarFiltroBtn.addEventListener('click', function() {
          actualizarTodoElPanel();
        });
        
        limpiarFiltroBtn.addEventListener('click', function() {
          document.getElementById('filtroFecha').value = new Date().toISOString().split('T')[0];
          document.getElementById('filtroSupervisora').value = '';
          actualizarTodoElPanel();
        });
        
        exportarBtn.addEventListener("click", function() {
          exportarEstadisticasCompletas();
        });
        
        btnCitasMes.addEventListener('click', mostrarCitasDelMes);
        
        cerrarModal.addEventListener('click', function() {
          modal.style.display = 'none';
        });
        
        window.addEventListener('click', function(event) {
          if (event.target === modal) {
            modal.style.display = 'none';
          }
        });
      }

      // FUNCI√ìN CORREGIDA: Exportar estad√≠sticas con calificaci√≥n de origen
      function exportarEstadisticasCompletas() {
        if (registrosPremanifiesto.length === 0) {
          mostrarNotificacion("NO HAY DATOS PARA EXPORTAR", 'error');
          return;
        }

        try {
          const workbook = new ExcelJS.Workbook();
          
          const wsResumen = workbook.addWorksheet("RESUMEN GENERAL");
          
          const tituloRow = wsResumen.addRow(["REPORTE DE ESTAD√çSTICAS - BLUE ELEGANCE"]);
          tituloRow.font = { size: 16, bold: true };
          tituloRow.alignment = { horizontal: 'center' };
          wsResumen.mergeCells('A1:F1');
          
          const fechaRow = wsResumen.addRow([`GENERADO EL: ${new Date().toLocaleString('es-MX')}`]);
          fechaRow.font = { bold: true };
          wsResumen.mergeCells('A2:F2');
          
          wsResumen.addRow([]);
          
          const totalCitas = registrosPremanifiesto.length;
          const supervisorasActivas = listaSupervisoras.length;
          const hoy = new Date().toISOString().split('T')[0];
          const citasHoy = registrosPremanifiesto.filter(reg => reg.fechaRegistro && reg.fechaRegistro.includes(hoy)).length;
          const eficienciaGeneral = calcularEficienciaGeneral(citasHoy);
          
          wsResumen.addRow(["ESTAD√çSTICAS GENERALES", "", "", "", "", ""]);
          wsResumen.addRow(["TOTAL DE CITAS REGISTRADAS:", totalCitas]);
          wsResumen.addRow(["SUPERVISORAS ACTIVAS:", supervisorasActivas]);
          wsResumen.addRow(["CITAS REGISTRADAS HOY:", citasHoy]);
          wsResumen.addRow(["EFICIENCIA GENERAL DEL EQUIPO:", `${eficienciaGeneral}%`]);
          wsResumen.addRow(["FECHA DEL REPORTE:", document.getElementById('filtroFecha').value]);
          
          const wsEstadisticas = workbook.addWorksheet("ESTAD√çSTICAS POR SUPERVISORA");
          
          const tituloEstRow = wsEstadisticas.addRow(["ESTAD√çSTICAS POR SUPERVISORA"]);
          tituloEstRow.font = { size: 16, bold: true };
          tituloEstRow.alignment = { horizontal: 'center' };
          wsEstadisticas.mergeCells('A1:F1');
          
          wsEstadisticas.addRow([]);
          
          const headersEst = ["SUPERVISORA", "TOTAL CITAS", "CITAS HOY", "EFICIENCIA", "PORCENTAJE", "ESTADO"];
          const headerEstRow = wsEstadisticas.addRow(headersEst);
          
          headerEstRow.eachCell((cell) => {
              cell.fill = {
                  type: 'pattern',
                  pattern: 'solid',
                  fgColor: { argb: 'FF1E40AF' }
              };
              cell.font = {
                  bold: true,
                  color: { argb: 'FFFFFFFF' }
              };
              cell.alignment = { horizontal: 'center' };
              cell.border = {
                  top: { style: 'thin' },
                  left: { style: 'thin' },
                  bottom: { style: 'thin' },
                  right: { style: 'thin' }
              };
          });
          
          const statsPorSupervisora = {};
          const hoyExport = new Date().toISOString().split('T')[0];
          
          listaSupervisoras.forEach(supervisora => {
              const citasSupervisora = registrosPremanifiesto.filter(reg => reg.supervisora === supervisora);
              const citasHoy = citasSupervisora.filter(reg => 
                reg.fechaRegistro && reg.fechaRegistro.includes(hoyExport)
              ).length;
              
              const eficiencia = calcularEficienciaSupervisora(citasHoy);
              const porcentaje = totalCitas > 0 ? ((citasSupervisora.length / totalCitas) * 100).toFixed(2) : 0;
              const estado = citasSupervisora.length > 0 ? "ACTIVA" : "SIN CITAS";
              
              statsPorSupervisora[supervisora] = {
                  total: citasSupervisora.length,
                  hoy: citasHoy,
                  eficiencia: eficiencia !== 0 ? `${eficiencia}%` : '0%',
                  porcentaje: `${porcentaje}%`,
                  estado: estado
              };
          });
          
          Object.keys(statsPorSupervisora).forEach(supervisora => {
              const stats = statsPorSupervisora[supervisora];
              
              wsEstadisticas.addRow([
                  supervisora,
                  stats.total,
                  stats.hoy,
                  stats.eficiencia,
                  stats.porcentaje,
                  stats.estado
              ]);
          });
          
          wsEstadisticas.columns = [
              { width: 25 }, { width: 15 }, { width: 15 }, { width: 15 }, { width: 15 }, { width: 15 }
          ];
          
          const wsDetalle = workbook.addWorksheet("DETALLE DE CITAS");
          
          const tituloDetRow = wsDetalle.addRow(["DETALLE COMPLETO DE CITAS"]);
          tituloDetRow.font = { size: 16, bold: true };
          tituloDetRow.alignment = { horizontal: 'center' };
          wsDetalle.mergeCells('A1:Q1'); // CORREGIDO: A1:Q1 para incluir la columna de ingresos
          
          wsDetalle.addRow([]);
          
          // CORREGIDO: Incluir la columna de ingresos y calificaci√≥n de origen
          const headersDet = [
            'NUM CITAS', 'CLIENTE Y NOMBRE ACOMPA√ëANTE', 'NUM PERSONAS', 'ESTADO CIVIL', 'HORA', 
            'D√çA EVENTO', 'SALON', 'EDAD', 'INGRESOS', 'TARJETA', 'CALIF DE ORIGEN', 'GERENTE', 
            'OPERADOR', 'VENDEDOR', 'BASE DE DATOS', 'SUPERVISORA', 'TELEFONO'
          ];
          
          const headerDetRow = wsDetalle.addRow(headersDet);
          
          headerDetRow.eachCell((cell) => {
              cell.fill = {
                  type: 'pattern',
                  pattern: 'solid',
                  fgColor: { argb: 'FF10B981' }
              };
              cell.font = {
                  bold: true,
                  color: { argb: 'FFFFFFFF' }
              };
              cell.alignment = { horizontal: 'center' };
              cell.border = {
                  top: { style: 'thin' },
                  left: { style: 'thin' },
                  bottom: { style: 'thin' },
                  right: { style: 'thin' }
              };
          });
          
          registrosPremanifiesto.forEach(registro => {
              const row = wsDetalle.addRow([
                  registro.citaPorDia || registro.cita || '',
                  registro.nombre || '',
                  registro.numPersonas || '',
                  registro.estadoCivil || '',
                  registro.hora || '',
                  registro.diaEvento || '',
                  registro.hotel || '',
                  registro.edad || '',
                  registro.ingresos || '', // COLUMNA DE INGRESOS
                  registro.tarjeta || '',
                  registro.calificacionOrigen || '', // COLUMNA DE CALIFICACI√ìN DE ORIGEN
                  registro.gerente || '',
                  registro.operador || '',
                  registro.vendedor || '',
                  registro.baseDatos || '',
                  registro.supervisora || '',
                  registro.telefono || ''
              ]);
              
              row.eachCell((cell) => {
                  cell.border = {
                      top: { style: 'thin' },
                      left: { style: 'thin' },
                      bottom: { style: 'thin' },
                      right: { style: 'thin' }
                  };
              });
          });
          
          // CORREGIDO: Ajustar anchos de columnas para incluir ingresos
          wsDetalle.columns = [
              { width: 10 }, { width: 35 }, { width: 15 }, { width: 15 }, { width: 12 },
              { width: 15 }, { width: 25 }, { width: 10 }, { width: 15 }, { width: 22 }, 
              { width: 18 }, { width: 15 }, { width: 15 }, { width: 12 }, { width: 15 }, 
              { width: 15 }, { width: 18 }
          ];
          
          workbook.xlsx.writeBuffer().then(buffer => {
              const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
              const fecha = new Date().toISOString().split('T')[0];
              saveAs(blob, `REPORTE_ESTADISTICAS_COMPLETO_${fecha}.xlsx`);
              mostrarNotificacion("REPORTE DE ESTAD√çSTICAS DESCARGADO CORRECTAMENTE");
          });
          
        } catch (error) {
          console.error('ERROR AL GENERAR EL REPORTE DE ESTAD√çSTICAS:', error);
          mostrarNotificacion('OCURRI√ì UN ERROR AL GENERAR EL REPORTE', 'error');
        }
      }

      // INICIAR EL SISTEMA
      inicializarSistema();

    });
  </script>
</body>
</html>