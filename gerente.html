<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Panel del Gerente</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: linear-gradient(135deg, #0a0f2b, #152347, #1e3a8a);
      background-size: 400% 400%;
      animation: gradient 15s ease infinite;
      color: #e2e8f0;
      line-height: 1.6;
      padding: 20px;
      min-height: 100vh;
      overflow-x: hidden;
    }

    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .container {
      max-width: 1400px;
      margin: auto;
      background: rgba(15, 23, 42, 0.85);
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
      animation: slideUp 0.8s ease-out;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(56, 189, 248, 0.2);
    }

    @keyframes slideUp {
      from { transform: translateY(30px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 35px;
      padding-bottom: 25px;
      border-bottom: 3px solid #38bdf8;
      background: linear-gradient(145deg, #1e293b, #0f172a);
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      position: relative;
      overflow: hidden;
    }

    header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: linear-gradient(90deg, #38bdf8, #3b82f6, #6366f1);
      animation: headerLine 3s ease infinite;
    }

    @keyframes headerLine {
      0% { transform: translateX(-100%); }
      50% { transform: translateX(0); }
      100% { transform: translateX(100%); }
    }

    .logo-container {
      display: flex;
      align-items: center;
      gap: 25px;
    }

    .logo-img-container {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: linear-gradient(145deg, #1e293b, #0f172a);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
      overflow: hidden;
      border: 4px solid #38bdf8;
      animation: pulse 3s infinite;
      position: relative;
    }

    @keyframes pulse {
      0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(56, 189, 248, 0.7); }
      70% { transform: scale(1.05); box-shadow: 0 0 0 15px rgba(56, 189, 248, 0); }
      100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(56, 189, 248, 0); }
    }

    .logo-img-container img {
      max-width: 85%;
      max-height: 85%;
      object-fit: contain;
      border-radius: 50%;
    }

    .logo-text h1 {
      color: #f1f5f9;
      font-size: 2.4rem;
      margin-bottom: 8px;
      font-weight: 700;
      background: linear-gradient(90deg, #38bdf8, #60a5fa);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .logo-text p {
      color: #94a3b8;
      font-size: 1.2rem;
      font-weight: 500;
      letter-spacing: 0.5px;
    }

    .header-controls {
      display: flex;
      gap: 15px;
    }

    h2 {
      color: #f1f5f9;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 2px solid #38bdf8;
      font-size: 1.9rem;
      display: flex;
      align-items: center;
      gap: 12px;
      position: relative;
    }

    h2::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 80px;
      height: 3px;
      background: linear-gradient(90deg, #38bdf8, #60a5fa);
      border-radius: 3px;
    }

    /* Resumen general mejorado */
    .resumen-general {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 25px;
      margin-bottom: 35px;
    }

    .resumen-item {
      background: linear-gradient(145deg, #1e293b, #0f172a);
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      text-align: center;
      transition: all 0.4s ease;
      border-left: 5px solid #38bdf8;
      position: relative;
      overflow: hidden;
    }

    .resumen-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(56, 189, 248, 0.1), rgba(96, 165, 250, 0.1));
      opacity: 0;
      transition: opacity 0.4s ease;
    }

    .resumen-item:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
    }

    .resumen-item:hover::before {
      opacity: 1;
    }

    .resumen-item .icono {
      font-size: 2.8rem;
      margin-bottom: 15px;
      color: #38bdf8;
      transition: transform 0.3s ease;
    }

    .resumen-item:hover .icono {
      transform: scale(1.2);
    }

    .resumen-item .valor {
      font-size: 2.5rem;
      font-weight: bold;
      color: #f1f5f9;
      margin-bottom: 8px;
      transition: color 0.3s ease;
    }

    .resumen-item:hover .valor {
      color: #38bdf8;
    }

    .resumen-item .etiqueta {
      font-size: 1.1rem;
      color: #94a3b8;
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    /* Panel del Gerente mejorado */
    .gerente-panel {
      background: linear-gradient(145deg, #1e293b, #0f172a);
      padding: 30px;
      border-radius: 15px;
      margin-top: 30px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
      position: relative;
      overflow: hidden;
    }

    .gerente-panel::before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 200px;
      height: 200px;
      background: radial-gradient(circle, rgba(56, 189, 248, 0.1) 0%, rgba(56, 189, 248, 0) 70%);
      border-radius: 50%;
    }

    .gerente-panel h2 {
      color: #f1f5f9;
      margin-bottom: 25px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .stats-container {
      display: flex;
      flex-wrap: wrap;
      gap: 25px;
      margin-bottom: 35px;
    }

    .stat-card {
      flex: 1;
      min-width: 240px;
      background: linear-gradient(145deg, #1e293b, #0f172a);
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
      text-align: center;
      transition: all 0.4s ease;
      border-top: 5px solid #38bdf8;
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: linear-gradient(90deg, #38bdf8, #60a5fa);
      transform: scaleX(0);
      transform-origin: left;
      transition: transform 0.4s ease;
    }

    .stat-card:hover::before {
      transform: scaleX(1);
    }

    .stat-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 25px rgba(0, 0, 0, 0.4);
    }

    .stat-card.leader {
      background: linear-gradient(145deg, #1e40af, #1d4ed8);
      color: #f1f5f9;
      border-top: 5px solid #60a5fa;
    }

    .stat-card h3 {
      font-size: 1.2rem;
      margin-bottom: 18px;
      color: inherit;
      font-weight: 600;
    }

    .stat-card .count {
      font-size: 2.8rem;
      font-weight: bold;
      margin-bottom: 12px;
      transition: transform 0.3s ease;
    }

    .stat-card:hover .count {
      transform: scale(1.1);
    }

    .stat-card .supervisora {
      font-size: 0.95rem;
      opacity: 0.9;
    }

    /* NUEVO: Estilo para mostrar el conteo por d√≠a */
    .conteo-dia {
      margin-top: 15px;
      padding: 12px;
      background: rgba(30, 41, 59, 0.7);
      border-radius: 8px;
      font-size: 0.9rem;
      border-left: 3px solid #38bdf8;
    }

    .conteo-dia .titulo {
      font-weight: 600;
      color: #60a5fa;
      margin-bottom: 5px;
    }

    .conteo-dia .valor-dia {
      font-size: 1.3rem;
      font-weight: bold;
      color: #f1f5f9;
    }

    .supervisora-detalle {
      margin-top: 35px;
    }

    .supervisora-detalle h3 {
      margin-bottom: 20px;
      color: #f1f5f9;
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 1.5rem;
    }

    .supervisora-citas {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }

    .cita-item {
      background: linear-gradient(145deg, #1e293b, #0f172a);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 5px 12px rgba(0, 0, 0, 0.3);
      border-left: 4px solid #38bdf8;
      font-size: 0.95rem;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .cita-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: linear-gradient(to bottom, #38bdf8, #60a5fa);
      transition: width 0.3s ease;
    }

    .cita-item:hover {
      transform: translateX(8px);
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.4);
    }

    .cita-item:hover::before {
      width: 8px;
    }

    .cita-item .cita-numero {
      font-weight: bold;
      color: #60a5fa;
      font-size: 1.1rem;
    }

    .cita-item .cita-cliente {
      margin: 10px 0;
      font-weight: 500;
      color: #e2e8f0;
    }

    .cita-item .cita-hora {
      color: #94a3b8;
      font-size: 0.9rem;
    }

    /* Controles para el panel del gerente mejorados */
    .panel-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 25px;
      margin-bottom: 30px;
      align-items: center;
      padding: 25px;
      background: rgba(30, 41, 59, 0.7);
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(5px);
      border: 1px solid rgba(56, 189, 248, 0.2);
    }

    .filtro-group {
      display: flex;
      flex-direction: column;
      gap: 12px;
      padding: 18px;
      background: rgba(30, 41, 59, 0.8);
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
      min-width: 240px;
      border: 1px solid #334155;
      position: relative;
      overflow: hidden;
    }

    .filtro-group::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background: linear-gradient(90deg, #38bdf8, #60a5fa);
      transform: scaleX(0);
      transform-origin: left;
      transition: transform 0.3s ease;
    }

    .filtro-group:hover::before {
      transform: scaleX(1);
    }

    .filtro-group:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.4);
      background: rgba(30, 41, 59, 0.9);
    }

    .filtro-group label {
      margin: 0;
      font-size: 0.95rem;
      color: #e2e8f0;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .filtro-group input, .filtro-group select {
      margin: 0;
      padding: 12px;
      border: 1px solid #475569;
      border-radius: 8px;
      background: #1e293b;
      color: #e2e8f0;
      font-size: 0.95rem;
      transition: all 0.3s ease;
    }

    .filtro-group input:focus, .filtro-group select:focus {
      border-color: #38bdf8;
      box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.2);
      outline: none;
    }

    .btn-group {
      display: flex;
      gap: 15px;
      align-items: center;
      flex-wrap: wrap;
    }

    .btn-filtro {
      background: linear-gradient(145deg, #38bdf8, #0ea5e9);
      color: #0f172a;
      border: none;
      padding: 14px 22px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 0.95rem;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 5px 12px rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: center;
      gap: 10px;
      position: relative;
      overflow: hidden;
    }

    .btn-filtro::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s ease;
    }

    .btn-filtro:hover::before {
      left: 100%;
    }

    .btn-filtro:hover {
      background: linear-gradient(145deg, #0ea5e9, #0284c7);
      transform: translateY(-3px);
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.4);
    }

    .btn-filtro:active {
      transform: translateY(0);
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
    }

    .btn-filtro i {
      font-size: 1.1rem;
    }

    .btn-limpiar {
      background: linear-gradient(145deg, #ef4444, #dc2626);
    }

    .btn-limpiar:hover {
      background: linear-gradient(145deg, #dc2626, #b91c1c);
    }

    .btn-exportar {
      background: linear-gradient(145deg, #10b981, #059669);
    }

    .btn-exportar:hover {
      background: linear-gradient(145deg, #059669, #047857);
    }

    .btn-volver {
      background: linear-gradient(145deg, #8b5cf6, #7c3aed);
    }

    .btn-volver:hover {
      background: linear-gradient(145deg, #7c3aed, #6d28d9);
    }

    .sin-datos {
      text-align: center;
      padding: 50px;
      color: #94a3b8;
      font-style: italic;
      font-size: 1.2rem;
      background: rgba(30, 41, 59, 0.7);
      border-radius: 12px;
      box-shadow: 0 5px 12px rgba(0, 0, 0, 0.3);
    }

    .notificacion {
      position: fixed;
      top: 25px;
      right: 25px;
      background: linear-gradient(145deg, #10b981, #059669);
      color: #0f172a;
      padding: 18px 25px;
      border-radius: 10px;
      z-index: 1000;
      box-shadow: 0 8px 20px rgba(0,0,0,0.4);
      animation: slideInRight 0.5s ease-out;
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 500;
      backdrop-filter: blur(5px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    @keyframes slideInRight {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    .actualizando {
      display: inline-block;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Gr√°fico mejorado */
    .grafico-container {
      background: linear-gradient(145deg, #1e293b, #0f172a);
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
      margin-bottom: 30px;
      position: relative;
      overflow: hidden;
    }

    .grafico-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: linear-gradient(90deg, #38bdf8, #60a5fa, #8b5cf6);
    }

    .barra {
      display: flex;
      align-items: center;
      margin-bottom: 18px;
      position: relative;
    }

    .barra-label {
      width: 160px;
      font-weight: 600;
      color: #e2e8f0;
    }

    .barra-progreso {
      flex: 1;
      height: 28px;
      background: #334155;
      border-radius: 14px;
      overflow: hidden;
      position: relative;
      box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3);
    }

    .barra-relleno {
      height: 100%;
      background: linear-gradient(90deg, #38bdf8, #60a5fa);
      border-radius: 14px;
      transition: width 1.2s ease;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding-right: 12px;
      color: #0f172a;
      font-weight: 600;
      font-size: 0.85rem;
      position: relative;
      overflow: hidden;
    }

    .barra-relleno::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transform: translateX(-100%);
      animation: shine 2s infinite;
    }

    @keyframes shine {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    /* Secci√≥n de Estad√≠sticas por Supervisora */
    .estadisticas-supervisoras {
      background: linear-gradient(145deg, #1e293b, #0f172a);
      padding: 30px;
      border-radius: 15px;
      margin-top: 30px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
      position: relative;
      overflow: hidden;
    }

    .estadisticas-supervisoras::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: linear-gradient(90deg, #38bdf8, #60a5fa, #8b5cf6);
    }

    .estadisticas-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 25px;
      margin-top: 20px;
    }

    .estadistica-item {
      background: linear-gradient(145deg, #1e293b, #0f172a);
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      text-align: center;
      transition: all 0.3s ease;
      border-left: 4px solid #38bdf8;
      position: relative;
      overflow: hidden;
    }

    .estadistica-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
    }

    .estadistica-item h4 {
      color: #e2e8f0;
      margin-bottom: 20px;
      font-size: 1.3rem;
      font-weight: 600;
    }

    .estadistica-item .grafico-circular {
      width: 120px;
      height: 120px;
      margin: 0 auto 20px;
      position: relative;
    }

    .estadistica-item .circulo-exterior {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: #334155;
      position: relative;
      overflow: hidden;
    }

    .estadistica-item .circulo-progreso {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      clip-path: polygon(50% 50%, 50% 0%, 100% 0%, 100% 100%, 0% 100%, 0% 0%);
      background: conic-gradient(#38bdf8 var(--porcentaje, 0%), #334155 0%);
      transition: all 1.5s ease;
    }

    .estadistica-item .circulo-interior {
      position: absolute;
      top: 10px;
      left: 10px;
      width: calc(100% - 20px);
      height: calc(100% - 20px);
      border-radius: 50%;
      background: #1e293b;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      font-weight: bold;
      color: #38bdf8;
    }

    .estadistica-item .meta-info {
      color: #94a3b8;
      font-size: 0.95rem;
      margin-top: 10px;
    }

    .estadistica-item .meta-info .meta {
      font-weight: 600;
      color: #60a5fa;
    }

    /* NUEVA SECCI√ìN: Gesti√≥n de Supervisoras */
    .gestion-supervisoras {
      background: linear-gradient(145deg, #1e293b, #0f172a);
      padding: 30px;
      border-radius: 15px;
      margin: 30px 0;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(56, 189, 248, 0.3);
      position: relative;
      overflow: hidden;
    }

    .gestion-supervisoras::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: linear-gradient(90deg, #38bdf8, #60a5fa, #8b5cf6);
    }

    .gestion-supervisoras h3 {
      color: #f1f5f9;
      margin-bottom: 25px;
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 1.5rem;
    }

    .gestion-controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 25px;
      margin-bottom: 25px;
    }

    @media (max-width: 768px) {
      .gestion-controls {
        grid-template-columns: 1fr;
      }
    }

    .agregar-supervisora, .eliminar-supervisora {
      background: rgba(30, 41, 59, 0.8);
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      border: 1px solid #334155;
    }

    .agregar-supervisora h4, .eliminar-supervisora h4 {
      color: #e2e8f0;
      margin-bottom: 20px;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .input-group {
      display: flex;
      gap: 12px;
      margin-bottom: 15px;
    }

    .input-group input, .input-group select {
      flex: 1;
      padding: 12px;
      border: 1px solid #475569;
      border-radius: 8px;
      background: #1e293b;
      color: #e2e8f0;
      font-size: 0.95rem;
    }

    .input-group input:focus, .input-group select:focus {
      border-color: #38bdf8;
      box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.2);
      outline: none;
    }

    .btn-agregar {
      background: linear-gradient(145deg, #10b981, #059669);
      color: #0f172a;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.95rem;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-agregar:hover {
      background: linear-gradient(145deg, #059669, #047857);
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
    }

    .btn-eliminar {
      background: linear-gradient(145deg, #ef4444, #dc2626);
      color: #0f172a;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.95rem;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-eliminar:hover {
      background: linear-gradient(145deg, #dc2626, #b91c1c);
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
    }

    .btn-eliminar:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .lista-supervisoras {
      background: rgba(30, 41, 59, 0.8);
      padding: 20px;
      border-radius: 10px;
      border: 1px solid #334155;
    }

    .lista-supervisoras h4 {
      color: #e2e8f0;
      margin-bottom: 15px;
      font-size: 1.1rem;
    }

    .supervisora-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      margin-bottom: 8px;
      background: rgba(30, 41, 59, 0.6);
      border-radius: 6px;
      border-left: 3px solid #38bdf8;
    }

    .supervisora-item:last-child {
      margin-bottom: 0;
    }

    .supervisora-nombre {
      font-weight: 600;
      color: #e2e8f0;
    }

    .supervisora-estado {
      background: #10b981;
      color: #0f172a;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    /* NUEVA SECCI√ìN: Controles de Administraci√≥n */
    .admin-controls {
      background: linear-gradient(145deg, #1e293b, #0f172a);
      padding: 25px;
      border-radius: 15px;
      margin: 30px 0;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(239, 68, 68, 0.3);
      position: relative;
      overflow: hidden;
    }

    .admin-controls::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: linear-gradient(90deg, #ef4444, #dc2626, #b91c1c);
    }

    .admin-controls h3 {
      color: #f1f5f9;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 1.5rem;
    }

    .admin-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      align-items: center;
    }

    .btn-admin {
      background: linear-gradient(145deg, #ef4444, #dc2626);
      color: #0f172a;
      border: none;
      padding: 14px 22px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 0.95rem;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 5px 12px rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: center;
      gap: 10px;
      position: relative;
      overflow: hidden;
    }

    .btn-admin:hover {
      background: linear-gradient(145deg, #dc2626, #b91c1c);
      transform: translateY(-3px);
      box-shadow: 0 8px 18px rgba(239, 68, 68, 0.4);
    }

    .btn-admin:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .btn-admin.warning {
      background: linear-gradient(145deg, #f59e0b, #d97706);
    }

    .btn-admin.warning:hover {
      background: linear-gradient(145deg, #d97706, #b45309);
    }

    .btn-admin.success {
      background: linear-gradient(145deg, #10b981, #059669);
    }

    .btn-admin.success:hover {
      background: linear-gradient(145deg, #059669, #047857);
    }

    /* Modal de confirmaci√≥n para acciones administrativas */
    .modal-admin {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.8);
      animation: fadeIn 0.3s;
    }

    .modal-admin-contenido {
      background: linear-gradient(145deg, #1e293b, #0f172a);
      margin: 15% auto;
      padding: 25px;
      border-radius: 16px;
      width: 400px;
      box-shadow: 0 20px 50px rgba(239, 68, 68, 0.3);
      animation: slideDown 0.3s;
      border: 1px solid rgba(239, 68, 68, 0.3);
      position: relative;
      overflow: hidden;
    }

    .modal-admin-contenido::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #ef4444, #dc2626, #b91c1c);
    }

    .modal-admin-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(239, 68, 68, 0.2);
    }

    .modal-admin-header h3 {
      color: #ef4444;
      font-size: 1.3rem;
      margin: 0;
    }

    .admin-actions {
      display: flex;
      gap: 15px;
      justify-content: flex-end;
      margin-top: 20px;
    }

    /* Informaci√≥n de depuraci√≥n */
    .debug-info {
      margin-top: 20px;
      padding: 20px;
      background: rgba(30, 41, 59, 0.8);
      border-radius: 12px;
      font-size: 0.9rem;
      display: none;
      border: 1px solid rgba(56, 189, 248, 0.2);
      color: #60a5fa;
    }

    .debug-info h4 {
      color: #38bdf8;
      margin-bottom: 15px;
      font-size: 1.1rem;
    }

    .debug-content {
      font-family: 'Courier New', monospace;
      background: rgba(15, 23, 42, 0.6);
      padding: 15px;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 0.85rem;
    }

    /* Responsive */
    @media (max-width: 1200px) {
      .container {
        max-width: 95%;
        padding: 25px;
      }
      
      .resumen-general {
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      }
      
      .estadisticas-grid {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      }
    }

    @media (max-width: 992px) {
      .container {
        padding: 20px;
      }
      
      header {
        flex-direction: column;
        gap: 25px;
        text-align: center;
      }
      
      .logo-text h1 {
        font-size: 2.2rem;
      }
      
      .header-controls {
        justify-content: center;
        flex-wrap: wrap;
        width: 100%;
      }
      
      .stats-container {
        flex-direction: column;
      }
      
      .supervisora-citas {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      }
      
      .panel-controls {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .filtro-group {
        min-width: 100%;
      }
      
      .btn-group {
        width: 100%;
        justify-content: center;
      }

      .admin-buttons {
        justify-content: center;
      }
    }

    @media (max-width: 768px) {
      body {
        padding: 15px;
      }
      
      .container {
        padding: 15px;
        border-radius: 15px;
      }
      
      header {
        padding: 20px;
      }
      
      .logo-container {
        flex-direction: column;
        gap: 15px;
      }
      
      .logo-text h1 {
        font-size: 2rem;
      }
      
      .logo-text p {
        font-size: 1.1rem;
      }
      
      .resumen-general {
        grid-template-columns: 1fr;
        gap: 20px;
      }
      
      .gerente-panel {
        padding: 20px;
      }
      
      .supervisora-citas {
        grid-template-columns: 1fr;
      }
      
      .panel-controls {
        padding: 20px;
      }
      
      h2 {
        font-size: 1.7rem;
      }
      
      .notificacion {
        top: 15px;
        right: 15px;
        left: 15px;
        text-align: center;
        justify-content: center;
      }
      
      .estadisticas-grid {
        grid-template-columns: 1fr;
      }
      
      .admin-buttons {
        flex-direction: column;
      }
      
      .btn-admin {
        width: 100%;
        justify-content: center;
      }
    }

    @media (max-width: 576px) {
      body {
        padding: 10px;
      }
      
      .container {
        padding: 15px;
      }
      
      .logo-img-container {
        width: 80px;
        height: 80px;
      }
      
      .logo-text h1 {
        font-size: 1.8rem;
      }
      
      .resumen-item {
        padding: 20px;
      }
      
      .resumen-item .valor {
        font-size: 2.2rem;
      }
      
      .modal-admin-contenido {
        width: 90%;
        margin: 10% auto;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo-container">
        <div class="logo-img-container">
          <img src="Imagenes/logo.png" alt="Logo Travel Life Club">
        </div>
        <div class="logo-text">
          <h1>Travel Life Club</h1>
          <p>Panel de Control - Gerente</p>
        </div>
      </div>
      <div class="header-controls">
        <button class="btn-filtro" id="actualizarBtn">
          <i class="fas fa-sync-alt"></i> Actualizar
        </button>
        <button class="btn-filtro btn-exportar" id="exportarEstadisticas">
          <i class="fas fa-file-excel"></i> Exportar Estad√≠sticas
        </button>
        <button class="btn-filtro btn-volver" onclick="window.location.href='index.html'">
          <i class="fas fa-arrow-left"></i> Volver al Sistema
        </button>
      </div>
    </header>

    <!-- Resumen General -->
    <section class="resumen-general" id="resumenGeneral">
      <!-- Los datos del resumen se generar√°n din√°micamente -->
    </section>

    <!-- NUEVA SECCI√ìN: Gesti√≥n de Supervisoras -->
    <section class="gestion-supervisoras">
      <h3><i class="fas fa-users-cog"></i> Gesti√≥n de Supervisoras</h3>
      
      <div class="gestion-controls">
        <div class="agregar-supervisora">
          <h4><i class="fas fa-user-plus"></i> Agregar Nueva Supervisora</h4>
          <div class="input-group">
            <input type="text" id="nuevaSupervisora" placeholder="Nombre de la nueva supervisora">
            <button class="btn-agregar" id="btnAgregarSupervisora">
              <i class="fas fa-plus"></i> Agregar
            </button>
          </div>
          <p style="color: #94a3b8; font-size: 0.9rem; margin-top: 10px;">
            La nueva supervisora estar√° disponible inmediatamente en todo el sistema.
          </p>
        </div>
        
        <div class="eliminar-supervisora">
          <h4><i class="fas fa-user-minus"></i> Eliminar Supervisora</h4>
          <div class="input-group">
            <select id="selectEliminarSupervisora">
              <option value="">Seleccione una supervisora</option>
            </select>
            <button class="btn-eliminar" id="btnEliminarSupervisora">
              <i class="fas fa-trash"></i> Eliminar
            </button>
          </div>
          <p style="color: #94a3b8; font-size: 0.9rem; margin-top: 10px;">
            Los registros existentes mantendr√°n el nombre hist√≥rico de la supervisora.
          </p>
        </div>
      </div>
      
      <div class="lista-supervisoras">
        <h4><i class="fas fa-list"></i> Supervisoras Activas</h4>
        <div id="listaSupervisorasContainer">
          <!-- Las supervisoras se cargar√°n aqu√≠ din√°micamente -->
        </div>
      </div>
    </section>

    <!-- NUEVA SECCI√ìN: Controles de Administraci√≥n -->
    <section class="admin-controls">
      <h3><i class="fas fa-cogs"></i> Controles de Administraci√≥n</h3>
      <div class="admin-buttons">
        <button class="btn-admin warning" id="limpiarRegistros">
          <i class="fas fa-trash-alt"></i> Limpiar Todos los Registros
        </button>
        <button class="btn-admin success" id="descargarEliminados">
          <i class="fas fa-file-export"></i> Descargar Registros Eliminados
        </button>
        <button class="btn-admin" id="debugBtn">
          <i class="fas fa-bug"></i> Depuraci√≥n del Sistema
        </button>
      </div>
    </section>

    <!-- Gr√°fico de distribuci√≥n -->
    <div class="grafico-container">
      <h2><i class="fas fa-chart-bar"></i> Distribuci√≥n de Citas por Supervisora</h2>
      <div id="graficoBarras">
        <!-- Gr√°fico se generar√° din√°micamente -->
      </div>
    </div>

    <!-- Secci√≥n de Estad√≠sticas por Supervisora -->
    <section class="estadisticas-supervisoras">
      <h2><i class="fas fa-chart-pie"></i> Estad√≠sticas por Supervisora</h2>
      <div class="estadisticas-grid" id="estadisticasGrid">
        <!-- Las estad√≠sticas se generar√°n din√°micamente aqu√≠ -->
      </div>
    </section>

    <!-- Panel del Gerente -->
    <section class="gerente-panel">
      <h2><i class="fas fa-chart-line"></i> Estad√≠sticas por Supervisora</h2>
      
      <!-- Controles para el panel del gerente -->
      <div class="panel-controls">
        <div class="filtro-group">
          <label for="filtroFecha"><i class="fas fa-calendar-alt"></i> Filtrar por fecha:</label>
          <input type="date" id="filtroFecha">
        </div>
        
        <div class="filtro-group">
          <label for="filtroSupervisora"><i class="fas fa-user-tie"></i> Filtrar por supervisora:</label>
          <select id="filtroSupervisora">
            <option value="">Todas las supervisoras</option>
            <!-- Las supervisoras se cargar√°n din√°micamente -->
          </select>
        </div>
        
        <div class="btn-group">
          <button type="button" id="aplicarFiltro" class="btn-filtro">
            <i class="fas fa-filter"></i> Aplicar Filtros
          </button>
          <button type="button" id="limpiarFiltro" class="btn-filtro btn-limpiar">
            <i class="fas fa-broom"></i> Limpiar
          </button>
        </div>
      </div>
      
      <div class="stats-container" id="statsContainer">
        <!-- Las estad√≠sticas se generar√°n din√°micamente aqu√≠ -->
      </div>
      
      <div class="supervisora-detalle" id="supervisoraDetalle">
        <!-- Los detalles de cada supervisora se generar√°n aqu√≠ -->
      </div>
    </section>

    <!-- Informaci√≥n de depuraci√≥n -->
    <div class="debug-info" id="debugInfo">
      <h4>Informaci√≥n de Depuraci√≥n del Sistema</h4>
      <div class="debug-content" id="debugContent"></div>
    </div>
  </div>

  <!-- Modal de confirmaci√≥n para limpiar registros -->
  <div id="modalConfirmacion" class="modal-admin">
    <div class="modal-admin-contenido">
      <div class="modal-admin-header">
        <h3><i class="fas fa-exclamation-triangle"></i> Confirmar Acci√≥n</h3>
        <span class="cerrar-modal">&times;</span>
      </div>
      <p id="mensajeConfirmacion">¬øEst√° seguro de que desea realizar esta acci√≥n? Esta acci√≥n no se puede deshacer.</p>
      <div class="admin-actions">
        <button class="btn-admin" id="cancelarAccion">Cancelar</button>
        <button class="btn-admin warning" id="confirmarAccion">Confirmar</button>
      </div>
    </div>
  </div>

  <!-- Librer√≠as necesarias -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <!-- ExcelJS para estilos en Excel -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.4.0/exceljs.min.js"></script>
  <!-- FileSaver para guardar archivos -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

  <script>
    // Configuraci√≥n de Firebase - DEBE SER LA MISMA QUE EN TU SISTEMA PRINCIPAL
    const firebaseConfig = {
      apiKey: "AIzaSyASUJrQNMW80DDMV8gFzjTYPUd8x3B5YDk",
      authDomain: "invitacionpremanfiesto.firebaseapp.com",
      databaseURL: "https://invitacionpremanfiesto-default-rtdb.firebaseio.com",
      projectId: "invitacionpremanfiesto",
      storageBucket: "invitacionpremanfiesto.firebasestorage.app",
      messagingSenderId: "362764197269",
      appId: "1:362764197269:web:058b028dcc53d299df6a9c",
      measurementId: "G-JYTW87S1MP"
    };

    // Inicializar Firebase
    firebase.initializeApp(firebaseConfig);

    // Variables para el historial de eliminados
    let historialEliminados = JSON.parse(localStorage.getItem('historial_eliminados') || '[]');
    let listaSupervisoras = [];

    document.addEventListener("DOMContentLoaded", function () {
      let registrosPremanifiesto = [];
      let actualizando = false;
      let accionPendiente = null;
      
      // Elementos del modal de confirmaci√≥n
      const modalConfirmacion = document.getElementById('modalConfirmacion');
      const mensajeConfirmacion = document.getElementById('mensajeConfirmacion');
      const btnCancelarAccion = document.getElementById('cancelarAccion');
      const btnConfirmarAccion = document.getElementById('confirmarAccion');
      const btnCerrarModal = document.querySelector('.cerrar-modal');

      // --- NUEVA FUNCI√ìN: EXPORTAR ESTAD√çSTICAS DE SUPERVISORAS Y CITAS ---
      function exportarEstadisticasCompletas() {
        if (registrosPremanifiesto.length === 0) {
          mostrarNotificacion("No hay datos para exportar", 'error');
          return;
        }

        try {
          // Crear un nuevo libro de Excel
          const workbook = new ExcelJS.Workbook();
          
          // HOJA 1: RESUMEN GENERAL
          const wsResumen = workbook.addWorksheet("Resumen General");
          
          // T√≠tulo
          const tituloRow = wsResumen.addRow(["REPORTE DE ESTAD√çSTICAS - TRAVEL LIFE CLUB"]);
          tituloRow.font = { size: 16, bold: true };
          tituloRow.alignment = { horizontal: 'center' };
          wsResumen.mergeCells('A1:F1');
          
          // Fecha de generaci√≥n
          const fechaRow = wsResumen.addRow([`Generado el: ${new Date().toLocaleString('es-MX')}`]);
          fechaRow.font = { bold: true };
          wsResumen.mergeCells('A2:F2');
          
          wsResumen.addRow([]);
          
          // Estad√≠sticas generales
          const totalCitas = registrosPremanifiesto.length;
          const supervisorasActivas = listaSupervisoras.length;
          const hoy = new Date().toISOString().split('T')[0];
          const citasHoy = registrosPremanifiesto.filter(reg => reg.fechaRegistro && reg.fechaRegistro.includes(hoy)).length;
          
          wsResumen.addRow(["ESTAD√çSTICAS GENERALES", "", "", "", "", ""]);
          wsResumen.addRow(["Total de Citas Registradas:", totalCitas]);
          wsResumen.addRow(["Supervisoras Activas:", supervisorasActivas]);
          wsResumen.addRow(["Citas Registradas Hoy:", citasHoy]);
          wsResumen.addRow(["Fecha del Reporte:", document.getElementById('filtroFecha').value]);
          
          wsResumen.addRow([]);
          
          // HOJA 2: ESTAD√çSTICAS POR SUPERVISORA
          const wsEstadisticas = workbook.addWorksheet("Estad√≠sticas por Supervisora");
          
          // T√≠tulo
          const tituloEstRow = wsEstadisticas.addRow(["ESTAD√çSTICAS POR SUPERVISORA"]);
          tituloEstRow.font = { size: 16, bold: true };
          tituloEstRow.alignment = { horizontal: 'center' };
          wsEstadisticas.mergeCells('A1:E1');
          
          wsEstadisticas.addRow([]);
          
          // Encabezados
          const headersEst = ["Supervisora", "Total Citas", "Citas Hoy", "Porcentaje", "Estado"];
          const headerEstRow = wsEstadisticas.addRow(headersEst);
          
          // Aplicar estilo a los encabezados
          headerEstRow.eachCell((cell) => {
              cell.fill = {
                  type: 'pattern',
                  pattern: 'solid',
                  fgColor: { argb: 'FF38BDF8' }
              };
              cell.font = {
                  bold: true,
                  color: { argb: 'FFFFFFFF' }
              };
              cell.alignment = { horizontal: 'center' };
              cell.border = {
                  top: { style: 'thin' },
                  left: { style: 'thin' },
                  bottom: { style: 'thin' },
                  right: { style: 'thin' }
              };
          });
          
          // Calcular estad√≠sticas por supervisora
          const statsPorSupervisora = {};
          listaSupervisoras.forEach(supervisora => {
              statsPorSupervisora[supervisora] = {
                  total: 0,
                  hoy: 0
              };
          });
          
          registrosPremanifiesto.forEach(registro => {
              if (registro.supervisora && statsPorSupervisora[registro.supervisora]) {
                  statsPorSupervisora[registro.supervisora].total++;
                  if (registro.fechaRegistro && registro.fechaRegistro.includes(hoy)) {
                      statsPorSupervisora[registro.supervisora].hoy++;
                  }
              }
          });
          
          // Agregar datos
          Object.keys(statsPorSupervisora).forEach(supervisora => {
              const stats = statsPorSupervisora[supervisora];
              const porcentaje = totalCitas > 0 ? ((stats.total / totalCitas) * 100).toFixed(2) : 0;
              const estado = stats.total > 0 ? "Activa" : "Sin citas";
              
              wsEstadisticas.addRow([
                  supervisora,
                  stats.total,
                  stats.hoy,
                  `${porcentaje}%`,
                  estado
              ]);
          });
          
          // Ajustar anchos de columnas
          wsEstadisticas.columns = [
              { width: 25 }, { width: 15 }, { width: 15 }, { width: 15 }, { width: 15 }
          ];
          
          // HOJA 3: DETALLE DE CITAS
          const wsDetalle = workbook.addWorksheet("Detalle de Citas");
          
          // T√≠tulo
          const tituloDetRow = wsDetalle.addRow(["DETALLE COMPLETO DE CITAS"]);
          tituloDetRow.font = { size: 16, bold: true };
          tituloDetRow.alignment = { horizontal: 'center' };
          wsDetalle.mergeCells('A1:P1');
          
          wsDetalle.addRow([]);
          
          // Encabezados
          const headersDet = [
            'NUM CITAS', 'CLIENTE Y NOMBRE ACOMPA√ëANTE', 'NUM PERSONAS', 'ESTADO CIVIL', 'HORA', 
            'D√çA EVENTO', 'SALON', 'EDAD', 'TARJETA', 'CALIF DE ORIGEN', 'GERENTE', 
            'OPERADOR', 'VENDEDOR', 'BASE DE DATOS', 'SUPERVISORA', 'TELEFONO'
          ];
          
          const headerDetRow = wsDetalle.addRow(headersDet);
          
          // Aplicar estilo a los encabezados
          headerDetRow.eachCell((cell) => {
              cell.fill = {
                  type: 'pattern',
                  pattern: 'solid',
                  fgColor: { argb: 'FF10B981' }
              };
              cell.font = {
                  bold: true,
                  color: { argb: 'FFFFFFFF' }
              };
              cell.alignment = { horizontal: 'center' };
              cell.border = {
                  top: { style: 'thin' },
                  left: { style: 'thin' },
                  bottom: { style: 'thin' },
                  right: { style: 'thin' }
              };
          });
          
          // Agregar datos de citas
          registrosPremanifiesto.forEach(registro => {
              const row = wsDetalle.addRow([
                  registro.citaPorDia || registro.cita || '',
                  registro.nombre || '',
                  registro.numPersonas || '',
                  registro.estadoCivil || '',
                  registro.hora || '',
                  registro.diaEvento || '',
                  registro.hotel || '',
                  registro.edad || '',
                  registro.tarjeta || '',
                  registro.calificacionOrigen || '',
                  registro.gerente || '',
                  registro.operador || '',
                  registro.vendedor || '',
                  registro.baseDatos || '',
                  registro.supervisora || '',
                  registro.telefono || ''
              ]);
              
              // Aplicar bordes a todas las celdas
              row.eachCell((cell) => {
                  cell.border = {
                      top: { style: 'thin' },
                      left: { style: 'thin' },
                      bottom: { style: 'thin' },
                      right: { style: 'thin' }
                  };
              });
          });
          
          // Ajustar anchos de columnas
          wsDetalle.columns = [
              { width: 10 }, { width: 35 }, { width: 15 }, { width: 15 }, { width: 12 },
              { width: 15 }, { width: 25 }, { width: 10 }, { width: 22 }, { width: 18 },
              { width: 15 }, { width: 15 }, { width: 12 }, { width: 15 }, { width: 15 }, { width: 18 }
          ];
          
          // Generar el archivo Excel
          workbook.xlsx.writeBuffer().then(buffer => {
              const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
              const fecha = new Date().toISOString().split('T')[0];
              saveAs(blob, `Reporte_Estadisticas_Completo_${fecha}.xlsx`);
              mostrarNotificacion("Reporte de estad√≠sticas descargado correctamente");
          });
          
        } catch (error) {
          console.error('Error al generar el reporte de estad√≠sticas:', error);
          mostrarNotificacion('Ocurri√≥ un error al generar el reporte', 'error');
        }
      }

      // --- GESTI√ìN DE SUPERVISORAS ---
      
      // Cargar lista de supervisoras SIN REPETICIONES
      function cargarListaSupervisoras() {
        const selectEliminar = document.getElementById('selectEliminarSupervisora');
        const selectFiltro = document.getElementById('filtroSupervisora');
        const listaContainer = document.getElementById('listaSupervisorasContainer');
        
        // Limpiar listas
        selectEliminar.innerHTML = '<option value="">Seleccione una supervisora</option>';
        selectFiltro.innerHTML = '<option value="">Todas las supervisoras</option>';
        listaContainer.innerHTML = '';
        
        // Cargar supervisoras desde Firebase
        const database = firebase.database();
        database.ref('supervisoras').once('value')
            .then((snapshot) => {
                const supervisoras = snapshot.val() || [];
                // ELIMINAR DUPLICADOS
                const supervisorasUnicas = [...new Set(supervisoras)];
                listaSupervisoras = supervisorasUnicas;
                
                supervisorasUnicas.forEach(supervisora => {
                    // Agregar al select de eliminaci√≥n
                    const optionEliminar = document.createElement('option');
                    optionEliminar.value = supervisora;
                    optionEliminar.textContent = supervisora;
                    selectEliminar.appendChild(optionEliminar);
                    
                    // Agregar al select de filtro
                    const optionFiltro = document.createElement('option');
                    optionFiltro.value = supervisora;
                    optionFiltro.textContent = supervisora;
                    selectFiltro.appendChild(optionFiltro);
                    
                    // Agregar a la lista visual
                    const item = document.createElement('div');
                    item.className = 'supervisora-item';
                    
                    const nombre = document.createElement('div');
                    nombre.className = 'supervisora-nombre';
                    nombre.textContent = supervisora;
                    
                    const estado = document.createElement('div');
                    estado.className = 'supervisora-estado';
                    estado.textContent = 'Activa';
                    
                    item.appendChild(nombre);
                    item.appendChild(estado);
                    listaContainer.appendChild(item);
                });
                
                console.log("Supervisoras cargadas (sin duplicados):", listaSupervisoras);
            })
            .catch(error => {
                console.error('Error al cargar supervisoras:', error);
                mostrarNotificacion('Error al cargar supervisoras', 'error');
            });
      }

      // Agregar supervisora
      document.getElementById('btnAgregarSupervisora').addEventListener('click', function() {
        const nombre = document.getElementById('nuevaSupervisora').value.trim();
        
        if (!nombre) {
            mostrarNotificacion('Ingrese el nombre de la supervisora', 'error');
            return;
        }
        
        const database = firebase.database();
        
        // Obtener lista actual
        database.ref('supervisoras').once('value')
            .then((snapshot) => {
                const supervisoras = snapshot.val() || [];
                const nombreUpper = nombre.toUpperCase();
                
                if (supervisoras.includes(nombreUpper)) {
                    mostrarNotificacion('Esta supervisora ya existe', 'error');
                    return;
                }
                
                // Agregar nueva supervisora
                supervisoras.push(nombreUpper);
                
                // Guardar en Firebase
                return database.ref('supervisoras').set(supervisoras);
            })
            .then(() => {
                document.getElementById('nuevaSupervisora').value = '';
                cargarListaSupervisoras();
                mostrarNotificacion(`Supervisora "${nombre.toUpperCase()}" agregada correctamente`);
            })
            .catch(error => {
                console.error('Error al agregar supervisora:', error);
                mostrarNotificacion('Error al agregar supervisora', 'error');
            });
      });
      
      // Eliminar supervisora
      document.getElementById('btnEliminarSupervisora').addEventListener('click', function() {
        const nombre = document.getElementById('selectEliminarSupervisora').value;
        
        if (!nombre) {
            mostrarNotificacion('Seleccione una supervisora para eliminar', 'error');
            return;
        }
        
        const database = firebase.database();
        
        // Obtener lista actual
        database.ref('supervisoras').once('value')
            .then((snapshot) => {
                let supervisoras = snapshot.val() || [];
                
                if (supervisoras.length <= 1) {
                    mostrarNotificacion('Debe haber al menos una supervisora', 'error');
                    return;
                }
                
                // Verificar registros asociados
                return database.ref('registrosPremanifiesto').once('value')
                    .then(registrosSnapshot => {
                        const registros = registrosSnapshot.val();
                        let registrosAsociados = 0;
                        
                        if (registros) {
                            Object.values(registros).forEach(registro => {
                                if (registro.supervisora === nombre) {
                                    registrosAsociados++;
                                }
                            });
                        }
                        
                        let mensaje = `¬øEst√° seguro de que desea eliminar a la supervisora "${nombre}"?`;
                        if (registrosAsociados > 0) {
                            mensaje += `\n\nADVERTENCIA: Hay ${registrosAsociados} registro(s) asignados a esta supervisora. Los registros mantendr√°n el nombre hist√≥rico.`;
                        }
                        
                        if (!confirm(mensaje)) {
                            return;
                        }
                        
                        // Eliminar supervisora
                        supervisoras = supervisoras.filter(s => s !== nombre);
                        
                        // Guardar en Firebase
                        return database.ref('supervisoras').set(supervisoras);
                    });
            })
            .then((result) => {
                if (result) {
                    document.getElementById('selectEliminarSupervisora').value = '';
                    cargarListaSupervisoras();
                    mostrarNotificacion(`Supervisora "${nombre}" eliminada correctamente`);
                }
            })
            .catch(error => {
                console.error('Error al eliminar supervisora:', error);
                mostrarNotificacion('Error al eliminar supervisora', 'error');
            });
      });

      // CONFIGURAR FIREBASE REALTIME DATABASE
      function configurarFirebase() {
          const database = firebase.database();
          const registrosRef = database.ref('registrosPremanifiesto');
          
          console.log("Conectando a Firebase desde el Panel del Gerente...");
          
          // Escuchar cambios en tiempo real desde Firebase
          registrosRef.on('value', (snapshot) => {
              const data = snapshot.val();
              if (data) {
                  // Convertir objeto de Firebase a array
                  registrosPremanifiesto = Object.values(data);
                  console.log("Datos sincronizados desde Firebase:", registrosPremanifiesto.length);
                  
                  // Actualizar el panel del gerente
                  actualizarPanelGerente();
                  
                  mostrarNotificacion("Datos actualizados en tiempo real desde Firebase");
              } else {
                  console.log("No hay datos en Firebase");
                  registrosPremanifiesto = [];
                  actualizarPanelGerente();
              }
          });
          
          // Escuchar cambios en supervisoras
          database.ref('supervisoras').on('value', (snapshot) => {
              const data = snapshot.val();
              if (data && Array.isArray(data)) {
                  // ELIMINAR DUPLICADOS
                  const supervisorasUnicas = [...new Set(data)];
                  listaSupervisoras = supervisorasUnicas;
                  cargarListaSupervisoras();
                  console.log("Supervisoras actualizadas en tiempo real (sin duplicados):", listaSupervisoras);
              }
          });
      }

      function mostrarNotificacion(mensaje, tipo = 'success') {
        // Crear elemento de notificaci√≥n
        const notificacion = document.createElement('div');
        notificacion.innerHTML = `<i class="fas fa-${tipo === 'error' ? 'exclamation-triangle' : 'info-circle'}"></i> ${mensaje}`;
        notificacion.className = `notificacion ${tipo === 'error' ? 'error' : ''}`;
        
        document.body.appendChild(notificacion);
        
        // Eliminar despu√©s de 4 segundos
        setTimeout(() => {
          if (notificacion.parentNode) {
            document.body.removeChild(notificacion);
          }
        }, 4000);
      }

      // --- FUNCI√ìN PARA MOSTRAR MODAL DE CONFIRMACI√ìN ---
      function mostrarConfirmacion(mensaje, accion) {
        mensajeConfirmacion.textContent = mensaje;
        accionPendiente = accion;
        modalConfirmacion.style.display = 'block';
      }

      // --- LIMPIAR TODOS LOS REGISTROS ---
      function limpiarTodosLosRegistros() {
        // Guardar copia de seguridad antes de eliminar
        const backup = {
          fecha: new Date().toISOString(),
          registros: [...registrosPremanifiesto],
          total: registrosPremanifiesto.length
        };
        
        // Agregar al historial de eliminados
        historialEliminados.push(backup);
        localStorage.setItem('historial_eliminados', JSON.stringify(historialEliminados));
        
        // Limpiar registros
        registrosPremanifiesto = [];
        
        // Guardar cambios en Firebase
        const database = firebase.database();
        database.ref('registrosPremanifiesto').set({})
          .then(() => {
            console.log("Todos los registros han sido eliminados de Firebase");
            actualizarPanelGerente();
            mostrarNotificacion(`Se eliminaron ${backup.total} registros correctamente. Se cre√≥ una copia de seguridad.`);
          })
          .catch(error => {
            console.error("Error al eliminar registros de Firebase:", error);
            mostrarNotificacion("Error al eliminar registros", 'error');
          });
      }

      // --- DESCARGAR REGISTROS ELIMINADOS ---
      function descargarRegistrosEliminados() {
        if (historialEliminados.length === 0) {
          mostrarNotificacion("No hay registros eliminados para descargar", 'error');
          return;
        }

        try {
          // Crear un nuevo libro de Excel
          const workbook = new ExcelJS.Workbook();
          
          // Para cada elemento del historial, crear una hoja
          historialEliminados.forEach((backup, index) => {
            const worksheet = workbook.addWorksheet(`Eliminados_${index + 1}`);
            
            // T√≠tulo
            const fecha = new Date(backup.fecha);
            const titulo = `REGISTROS ELIMINADOS - ${fecha.toLocaleDateString('es-MX')} ${fecha.toLocaleTimeString('es-MX')}`;
            
            const tituloRow = worksheet.addRow([titulo]);
            tituloRow.font = { size: 16, bold: true };
            tituloRow.alignment = { horizontal: 'center' };
            worksheet.mergeCells('A1:P1');
            
            // Saltar una l√≠nea
            worksheet.addRow([]);
            
            // Informaci√≥n del backup
            const infoRow = worksheet.addRow([`Total de registros eliminados: ${backup.total}`]);
            infoRow.font = { bold: true };
            worksheet.mergeCells('A3:P3');
            
            worksheet.addRow([]);
            
            // Encabezados
            const headers = [
              'NUM CITAS', 'CLIENTE Y NOMBREACOMPA√ëANTE', 'NUM PERSONAS', 'ESTADO CIVIL', 'HORA', 
              'D√çA EVENTO', 'SALON', 'EDAD', 'TARJETA', 'CALIF DE ORIGEN', 'GERENTE', 
              'OPERADOR', 'VENDEDOR', 'BASE DE DATOS', 'SUPERVISORA', 'TELEFONO'
            ];
            
            const headerRow = worksheet.addRow(headers);
            
            // Aplicar estilo a los encabezados
            headerRow.eachCell((cell) => {
                cell.fill = {
                    type: 'pattern',
                    pattern: 'solid',
                    fgColor: { argb: 'FFE74C3C' }
                };
                cell.font = {
                    bold: true,
                    color: { argb: 'FFFFFFFF' }
                };
                cell.alignment = { horizontal: 'center' };
                cell.border = {
                    top: { style: 'thin' },
                    left: { style: 'thin' },
                    bottom: { style: 'thin' },
                    right: { style: 'thin' }
                };
            });
            
            // A√±adir datos
            backup.registros.forEach(registro => {
                const row = worksheet.addRow([
                    registro.citaPorDia || registro.cita,
                    registro.nombre,
                    registro.numPersonas,
                    registro.estadoCivil,
                    registro.hora,
                    registro.diaEvento || '',
                    registro.hotel,
                    registro.edad,
                    registro.tarjeta,
                    registro.calificacionOrigen,
                    registro.gerente,
                    registro.operador,
                    registro.vendedor,
                    registro.baseDatos,
                    registro.supervisora,
                    registro.telefono
                ]);
                
                // Aplicar bordes a todas las celdas
                row.eachCell((cell) => {
                    cell.border = {
                        top: { style: 'thin' },
                        left: { style: 'thin' },
                        bottom: { style: 'thin' },
                        right: { style: 'thin' }
                    };
                });
            });
            
            // Ajustar anchos de columnas
            worksheet.columns = [
                { width: 10 }, { width: 35 }, { width: 15 }, { width: 15 }, { width: 12 },
                { width: 15 }, { width: 25 }, { width: 10 }, { width: 22 }, { width: 18 },
                { width: 15 }, { width: 15 }, { width: 12 }, { width: 15 }, { width: 15 }, { width: 18 }
            ];
          });
          
          // Generar el archivo Excel
          workbook.xlsx.writeBuffer().then(buffer => {
              const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
              const fecha = new Date().toISOString().split('T')[0];
              saveAs(blob, `Registros_Eliminados_Completos_${fecha}.xlsx`);
              mostrarNotificacion("Archivo de registros eliminados descargado correctamente");
          });
          
        } catch (error) {
          console.error('Error al generar el Excel de eliminados:', error);
          mostrarNotificacion('Ocurri√≥ un error al generar el archivo', 'error');
        }
      }

      // --- MOSTRAR INFORMACI√ìN DE DEPURACI√ìN ---
      function mostrarInformacionDepuracion() {
        const debugInfo = document.getElementById("debugInfo");
        const debugContent = document.getElementById("debugContent");
        
        if (debugInfo.style.display === "block") {
          debugInfo.style.display = "none";
          document.getElementById("debugBtn").innerHTML = '<i class="fas fa-bug"></i> Depuraci√≥n del Sistema';
        } else {
          debugInfo.style.display = "block";
          document.getElementById("debugBtn").innerHTML = '<i class="fas fa-times"></i> Ocultar Depuraci√≥n';
          
          // Mostrar informaci√≥n de depuraci√≥n
          const info = {
            'Registros actuales': registrosPremanifiesto.length,
            'Supervisoras activas': listaSupervisoras.length,
            'Historial de eliminados': historialEliminados.length,
            'Total eliminados': historialEliminados.reduce((total, backup) => total + backup.total, 0),
            'Firebase conectado': firebase.app().name ? "S√≠" : "No",
            '√öltima sincronizaci√≥n': new Date().toLocaleString(),
            'Navegador': navigator.userAgent,
            'Estado de conexi√≥n': navigator.onLine ? "En l√≠nea" : "Sin conexi√≥n",
            'Memoria usada': Math.round(performance.memory.usedJSHeapSize / 1048576) + ' MB'
          };
          
          let contenido = '';
          Object.keys(info).forEach(key => {
            contenido += `<div><strong>${key}:</strong> ${info[key]}</div>`;
          });
          
          // Agregar informaci√≥n del historial de eliminados
          contenido += '\n\n<strong>Historial detallado:</strong>\n';
          historialEliminados.forEach((backup, index) => {
            const fecha = new Date(backup.fecha);
            contenido += `\n${index + 1}. ${fecha.toLocaleString()} - ${backup.total} registros`;
          });
          
          // Agregar informaci√≥n de supervisoras
          contenido += '\n\n<strong>Supervisoras:</strong>\n';
          listaSupervisoras.forEach((supervisora, index) => {
            contenido += `\n${index + 1}. ${supervisora}`;
          });
          
          debugContent.innerHTML = contenido;
        }
      }

      // --- EVENT LISTENERS PARA BOTONES DE ADMINISTRACI√ìN ---
      
      // Limpiar todos los registros
      document.getElementById("limpiarRegistros").addEventListener("click", function() {
        if (registrosPremanifiesto.length === 0) {
          mostrarNotificacion("No hay registros para eliminar", 'error');
          return;
        }
        
        mostrarConfirmacion(
          `¬øEst√° seguro de que desea eliminar TODOS los ${registrosPremanifiesto.length} registros? Esta acci√≥n es irreversible pero se crear√° una copia de seguridad.`,
          'limpiar'
        );
      });
      
      // Descargar registros eliminados
      document.getElementById("descargarEliminados").addEventListener("click", function() {
        descargarRegistrosEliminados();
      });
      
      // Bot√≥n de depuraci√≥n
      document.getElementById("debugBtn").addEventListener("click", function() {
        mostrarInformacionDepuracion();
      });
      
      // Bot√≥n de exportar estad√≠sticas
      document.getElementById("exportarEstadisticas").addEventListener("click", function() {
        exportarEstadisticasCompletas();
      });
      
      // Confirmar acci√≥n en modal
      btnConfirmarAccion.addEventListener("click", function() {
        if (accionPendiente === 'limpiar') {
          limpiarTodosLosRegistros();
        }
        modalConfirmacion.style.display = 'none';
        accionPendiente = null;
      });
      
      // Cancelar acci√≥n en modal
      btnCancelarAccion.addEventListener("click", function() {
        modalConfirmacion.style.display = 'none';
        accionPendiente = null;
      });
      
      // Cerrar modal
      btnCerrarModal.addEventListener("click", function() {
        modalConfirmacion.style.display = 'none';
        accionPendiente = null;
      });
      
      // Cerrar modal al hacer clic fuera
      window.addEventListener('click', function(event) {
        if (event.target === modalConfirmacion) {
          modalConfirmacion.style.display = 'none';
          accionPendiente = null;
        }
      });

      // --- FUNCIONES DEL PANEL DEL GERENTE (se mantienen igual) ---
      
      function actualizarPanelGerente() {
        // Aqu√≠ ir√≠a el c√≥digo existente para actualizar las estad√≠sticas
        // y gr√°ficos del panel del gerente
        console.log("Actualizando panel del gerente con", registrosPremanifiesto.length, "registros");
        
        // Actualizar resumen general
        actualizarResumenGeneral();
        
        // Actualizar estad√≠sticas por supervisora
        actualizarEstadisticasSupervisoras();
        
        // Actualizar gr√°fico de barras
        actualizarGraficoBarras();
      }
      
      function actualizarResumenGeneral() {
        const resumenContainer = document.getElementById('resumenGeneral');
        // C√≥digo para actualizar el resumen general...
      }
      
      function actualizarEstadisticasSupervisoras() {
        const statsContainer = document.getElementById('statsContainer');
        // C√≥digo para actualizar estad√≠sticas por supervisora...
      }
      
      function actualizarGraficoBarras() {
        const graficoContainer = document.getElementById('graficoBarras');
        // C√≥digo para actualizar el gr√°fico de barras...
      }

      // INICIALIZAR FIREBASE Y EL PANEL
      configurarFirebase();
      cargarListaSupervisoras();
      
      // Establecer la fecha actual como valor por defecto en el filtro
      const hoy = new Date().toISOString().split('T')[0];
      document.getElementById('filtroFecha').value = hoy;
    });
  </script>
</body>
</html>